---
layout: tutorial
title: Custom Authentication in hybrid applications
relevantTo: [hybrid]
---
<ul>
<li class="download-sample">
<a href="https://github.com/MobileFirst-Platform-Developer-Center/CustomAuth" target="_blank">Download MobileFirst project</a>
        </li>
</ul>
<br>
This is a continuation of <a title="Custom Authentication" href="../">Custom Authentication</a>.</p>
<h2>Creating client-side authentication components</h2>
<p>The application consists of two main <em>div</em> elements:<br />
The <em>AppDiv</em> element is used to display the application content.<br />
The <em>AuthDiv</em> element is used for authentication forms.<br />
When authentication is required, the application hides <em>AppDiv</em> and shows <em>AuthDiv</em>. When authentication is complete, it does the opposite.</p>
<h3>AppDiv</h3>
<p>{% highlight html %}<br />
<div id="AppDiv"><br />
  <input type="button" id="getSecretDataButton" value="Call protected adapter proc" onclick="getSecretData()" /><br />
  <input type="button" class="appButton" value="Logout" onclick="WL.Client.logout('CustomAuthenticatorRealm',{onSuccess: WL.Client.reloadApp})" /><br />
  <div id="ResponseDiv"></div><br />
</div><br />
{% endhighlight %}</p>
<p>Buttons are used to call the <em>getSecretData</em> procedure and to log out.</p>
<h3>AuthDiv</h3>
<p>{% highlight html %}<br />
<div id="AuthDiv" style="display: none"><br />
  <p id="AuthInfo"></p><br />
  <div id="loginForm"><br />
    <input type="text" id="AuthUsername" placeholder="Enter username" /><br />
    <br/><br />
    <br/><br />
    <input type="password" id="AuthPassword" placeholder="Enter password" /><br />
    <br/><br />
    <input type="button" id="AuthSubmitButton" class="formButton" value="Login" /><br />
    <input type="button" id="AuthCancelButton" class="formButton" value="Cancel" /><br />
  </div><br />
</div><br />
{% endhighlight %}</p>
<p><em>AuthDiv</em> is styled with <em>display:none</em> because it must not be displayed before the server requests the authentication.</p>
<h3>Challenge Handler</h3>
<p>Use <em>WL.Client.createChallengeHandler</em> to create a challenge handler object. Supply a realm name as a parameter.</p>
<p>{% highlight javascript %}<br />
var customAuthenticatorRealmChallengeHandler = WL.Client.createChallengeHandler("CustomAuthenticatorRealm");<br />
{% endhighlight %}</p>
<p>The <em>isCustomResponse</em> function of the challenge handler is called each time a response is received from the server.<br />
It is used to detect whether the response contains data that is related to this challenge handler. It must return <strong>true</strong> or <strong>false</strong>.</p>
<p>{% highlight javascript %}<br />
customAuthenticatorRealmChallengeHandler.isCustomResponse = function(response) {}<br />
{% endhighlight %}</p>
<p>If <em>isCustomResponse</em> returns true, the framework calls the <em>handleChallenge</em> function. This function is used to perform required actions, such as hide application screen and show login screen.</p>
<p>{% highlight javascript %}<br />
customAuthenticatorRealmChallengeHandler.handleChallenge = function(response){}<br />
{% endhighlight %}</p>
<p>In addition to the methods that the developer must implement, the challenge handler contains functionality that the developer might want to use:</p>
<ul>
<li><em>submitLoginForm</em> to send collected credentials to a specific URL. The developer can also specify request parameters, headers, and callback.</li>
<li><em>submitSuccess</em> to notify the framework that the authentication finished successfully. The framework then automatically issues the original request that triggered the authentication.</li>
<li><em>submitFailure</em> to notify the framework that the authentication completed with a failure. The framework then disposes of the original request that triggered the authentication</li>
</ul>
<p>Note: Attach each of these functions to its object. For example: <em>myChallengeHandler.submitSucces()</em></p>
<h3>isCustomResponse</h3>
<p>If the challenge JSON block contains the <em>authStatus</em> property, return <em>true</em>, otherwise return <em>false</em>.</p>
<p>{% highlight javascript %}<br />
customAuthenticatorRealmChallengeHandler.isCustomResponse = function(response) {<br />
    if (!response || !response.responseJSON) {<br />
        return false;<br />
    }</p>
<p>    if (response.responseJSON.authStatus)<br />
        return true;<br />
    else<br />
        return false;<br />
};<br />
{% endhighlight %}</p>
<h3>handleChallenge</h3>
<p>If the <em>authStatus</em> property equals “required”, show the login form, clean up the password input field, and display the error message if applicable.<br />
if <em>authStatus</em> equals “complete”, hide the login screen, return to the application, and notify the framework that authentication completed successfully.</p>
<p>{% highlight javascript %}<br />
customAuthenticatorRealmChallengeHandler.handleChallenge = function(response){<br />
    var authStatus = response.responseJSON.authStatus;</p>
<p>    if (authStatus == "required"){<br />
        $('#AppDiv').hide();<br />
        $('#AuthDiv').show();<br />
        $("#AuthInfo").empty();<br />
        $('#AuthPassword').val('');<br />
        if (response.responseJSON.errorMessage){<br />
            $("#AuthInfo").html(response.responseJSON.errorMessage);<br />
        }<br />
    } else if (authStatus == "complete"){<br />
        $('#AppDiv').show();<br />
        $('#AuthDiv').hide();<br />
        customAuthenticatorRealmChallengeHandler.submitSuccess();<br />
    }<br />
};<br />
{% endhighlight %}</p>
<p>Clicking the <strong>login</strong> button triggers the function that collects the user name and password from HTML input fields and submits them to server. You can set request headers here and specify callback functions.</p>
<p>{% highlight javascript %}<br />
$('#AuthSubmitButton').bind('click', function () {<br />
    var reqURL = '/my_custom_auth_request_url';<br />
    var options = {};<br />
    options.parameters = {<br />
        username : $('#AuthUsername').val(),<br />
        password : $('#AuthPassword').val()<br />
    };<br />
    options.headers = {};<br />
    customAuthenticatorRealmChallengeHandler.submitLoginForm(reqURL, options, customAuthenticatorRealmChallengeHandler.submitLoginFormCallback);<br />
});<br />
{% endhighlight %}</p>
<p>Clicking the <strong>cancel</strong> button hides <em>AuthDiv</em>, shows <em>AppDiv</em> and notifies the framework that authentication failed.</p>
<p>{% highlight javascript %}<br />
$('#AuthCancelButton').bind('click', function () {<br />
    $('#AppDiv').show();<br />
    $('#AuthDiv').hide();<br />
    customAuthenticatorRealmChallengeHandler.submitFailure();<br />
});<br />
{% endhighlight %}</p>
<p>The <strong>submitLoginFormCallback</strong> function checks the response for the containing server challenge once again. If the challenge is found, the <em>handleChallenge</em> function is called again.</p>
<p>{% highlight javascript %}<br />
customAuthenticatorRealmChallengeHandler.submitLoginFormCallback = function(response) {<br />
    var isLoginFormResponse = customAuthenticatorRealmChallengeHandler.isCustomResponse(response);<br />
    if (isLoginFormResponse){<br />
        customAuthenticatorRealmChallengeHandler.handleChallenge(response);<br />
    }<br />
};<br />
{% endhighlight %}</p>
<h2>Worklight Protocol</h2>
<p>If your custom authenticator uses <code>WorklightProtocolAuthenticator</code>, some simplifications can be made:</p>
<ul>
<li>Create the challenge handler using <code>WL.Client.create<strong>WL</strong>ChallengeHandler</code> instead of <code>WL.Client.createChallengeHandler</code>. Note the <code>WL</code> in the middle.</li>
<li>You no longer need to implement <code>isCustomResponse</code> as the challenge handler will automatically check that the realm name matches.</li>
<li><code>handleChallenge</code> will receive the challenge as a parameter, not the entire response object.</li>
<li>Instead of <code>submitLoginForm</code>, use <code>submitChallengeAnswer</code> to send your challenge response as a JSON.</li>
<li>There is no need to call <code>submitSuccess</code> or <code>submitFailure</code> as the framework will do it for you.</li>
</ul>
<blockquote><p>For an example that uses <code>WorklightProtocolAuthenticator</code>, see the <a href="../../../advanced-topics/remember-me/" title="Remember Me">Remember Me</a> tutorial or <a href="https://developer.ibm.com/mobilefirstplatform/blog/2015/05/29/ibm-mobilefirst-platform-foundation-custom-authenticators-and-login-modules/" target="_blank">this video blog post</a>.
</p></blockquote>
<h2>Sample application</h2>
<p><a href="https://github.com/MobileFirst-Platform-Developer-Center/CustomAuth" target="_blank">Click to download</a> the MobileFirst project.</p>
<p><a href="https://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2015/04/CustomAuth1.png"><img src="{{ site.baseurl }}/assets/backup/CustomAuth1-1024x584.png" alt="CustomAuth" width="980" height="558" class="aligncenter size-large wp-image-11511" /></a></p>
