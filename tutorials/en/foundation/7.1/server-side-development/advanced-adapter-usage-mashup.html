---
layout: tutorial
title: Advanced adapter usage and mashup
relevantTo: [hybrid]
downloads:
  - name: Download MobileFirst project
    url: https://github.com/MobileFirst-Platform-Developer-Center/AdapterMashup
---
<h2>Overview</h2>
<p>Now that basic usage of different types of adapters has been covered, it is important to remember that adapters can be combined to make a procedure that uses different adapters to generate one processed result. You can combine several sources (different HTTP servers, SQL, etc).</p>

<p>In theory, from the client side, you could make several requests successively, one depending on the other.
However, writing this logic on the server side could be faster and cleaner.</p>

<p>This tutorial covers the following topics:</p>

<ul>
    <li><a href="#JSAPI">JavaScript adapter API</a></li>
    <li><a href="#JavaAPI">Java adapter API</a></li>
    <li><a href="#dataMashup">Data mashup example</a></li>
    <li><a href="#sample">Sample application</a></li>
</ul>

<h2 id="JSAPI">JavaScript API</h2>
<h3 id="invoke">Calling a JavaScript adapter procedure from a JavaScript adapter</h3>
When calling a JavaScript adapter procedure from another JavaScript adapter use the <code>WL.Server.invokeProcedure(invocationData)</code> API.
This API is almost identical to its client-side counterpart, it enables you to invoke a procedure on any of your adapters.

The <code>invocationData</code> parameter has the same format as the client-side API.
<p>{% highlight javascript %}
WL.Server.invokeProcedure({ adapter : "AcmeBank", procedure : " getTransactions", parameters : [accountId, fromDate, toDate], });
{% endhighlight %}</p>

However, while the client-side <code>invokeProcedure</code> uses a success handler, the server-side only returns the result object itself.

<blockquote>Calling a Java adapter from a JavaScript adapter is not supported</blockquote>

<h2 id="JavaAPI">Java API</h2>
<h3 id="executeAdapterRequest">Calling a Java adapter from a Java adapter</h3>
When calling an adapter procedure from a Java adapter use the <code>executeAdapterRequest</code> API.
This call returns an HttpResponse object.
<p>{% highlight java %}
HttpUriRequest req = new HttpGet(MyAdapterProcedureURL);
org.apache.http.HttpResponse response = api.getAdaptersAPI().executeAdapterRequest(req);
JSONObject jsonObj = api.getAdaptersAPI().getResponseAsJSON(response);
{% endhighlight %}</p>
<br clear="all"/>

<h3 id="createJavaScriptAdapterRequest">Calling a JavaScript adapter procedure from a Java adapter</h3>
When calling a JavaScript adapter procedure from a Java adapter use both the <code>executeAdapterRequest</code> API and the <code>createJavascriptAdapterRequest</code> API that creates an HttpUriRequest to pass as a parameter to the <code>executeAdapterRequest</code> call.
<p>{% highlight java %}
HttpUriRequest req = api.getAdaptersAPI().createJavascriptAdapterRequest(AdapterName, ProcedureName, [parameters]);
org.apache.http.HttpResponse response = api.getAdaptersAPI().executeAdapterRequest(req);
JSONObject jsonObj = api.getAdaptersAPI().getResponseAsJSON(response);
{% endhighlight %}</p>
<br clear="all"/>

<h2 id="dataMashup">Data mashup example</h2>

The following example shows how to mash up data from 2 data sources, a database table and Yahoo! Weather Service, And to return the data stream to the application as a single object.

In this example we will use 2 adapters:
<ul>
  <li>
    Cities Adapter:
    <ul>
      <li>Extract a list of cities from a “weather” database table.</li>
      <li>The result contains the list of several cities around the world, their Yahoo! Weather identifier and some description.</li>
    </ul>
  </li>
  <li>
    Weather Adapter:
    <ul>
      <li>Connect to the Yahoo! Weather Service. </li>
      <li>Extract an updated weather forecast for each of the cities that are retrieved via the Cities adapter.</li>
    </ul>
  </li>
</ul>
Afterward, the mashed-up data is returned to the application for display.

<img src="AdapterMashupDiagram.jpg" alt="Adapter Mashup Diagram" />

The provided sample in this tutorial demonstrates the implementation of this scenario using 3 different mashup types. In each one of them the names of the adapters are slightly different. Here is a list of the mashup types and the corresponding adapter names:
<ol>
  <li><strong>JavaScript</strong> adapter -> <strong>JavaScript</strong> adapter
      <ul>
        <li>Cities adapter   = getCitiesListJS</li>
        <li>Weather adapter  = getCityWeatherJS</li>
      </ul>
  </li>
  <li><strong>Java</strong> adapter -> <strong>JavaScript</strong> adapter<br />
      <ul>
        <li>Cities adapter   = getCitiesListJavaToJS</li>
        <li>Weather adapter  = getCityWeatherJS</li>
      </ul>
  </li>
  <li><strong>Java</strong> adapter -> <strong>Java</strong> adapter<br />
      <ul>
        <li>Cities adapter   = getCitiesListJava</li>
        <li>Weather adapter  = getCityWeatherJava</li>
      </ul>
  </li>
</ol>

<blockquote>An example of city list in SQL is provided with the attached sample, under <code>server/mobilefirstTraining.sql</code>.
Remember that SQL adapters require a JDBC connector driver, which must be downloaded separately by the developer and added to the <code>server/lib</code> folder of the project.</blockquote>

<h2 id="sample">Sample application</h2>
<a href="https://github.com/MobileFirst-Platform-Developer-Center/AdapterMashup" target="_blank">Click to download</a> the MobileFirst project.

<a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/04_12_results.png"><img src="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/04_12_results.png" alt="04_12_results" width="319" height="545" class="aligncenter size-full wp-image-3275" /></a>
