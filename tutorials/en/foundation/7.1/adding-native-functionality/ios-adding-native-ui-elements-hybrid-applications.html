---
layout: tutorial
title: iOS - Adding native UI elements to hybrid applications
date: 2015-04-19 10:08:51.000000000 +03:00
type: tutorial
published: true
status: publish
categories: []
tags:
- 7-1
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6637'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"984a002a47179f5ee40a1e2a09fbfe45";a:2:{s:7:"expires";i:1442520914;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:9570;}i:1;a:1:{s:2:"id";i:9560;}i:2;a:1:{s:2:"id";i:11226;}}}}
author:
  login: nathanh@il.ibm.com
  email: NATHANH@il.ibm.com
  display_name: Nathan Hazout
  first_name: NATHAN
  last_name: HAZOUT
---
<p class="breadcrumbs">
 &lt; <a href="../">Adding native functionality to hybrid applications</a></p>
<div id="samplesAndPersonas">
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="hybrid">Hybrid</li>
</ul>
</div>
<ul>
<li class="download-sample">
 <a href="https://github.com/MobileFirst-Platform-Developer-Center/NativeUIInHybrid" target="_blank">Download MobileFirst project</a>
        </li>
</ul>
</div>
<h2>Overview</h2>
<p>You can write hybrid applications by using solely web technologies. However, IBM MobileFirst Platform Foundation also allows you to mix and match native code with web code as necessary.</p>
<p>For example, use native UI controls, use native elements, provide an animated native introduction screen, etc. To do so, you must take control of part of the application startup flow.</p>
<p><strong>Prerequisite:</strong> This tutorial assumes working knowledge of native iOS development.</p>
<p>This tutorial covers the following topics:</p>
<ul>
<li><a href="#control">Taking control of the startup flow</a></li>
<li><a href="#splash">Native SplashScreen sample</a></li>
<li><a href="#jsToNative">Sending commands from JavaScript code to native code</a></li>
<li><a href="#nativeToJs">Sending commands from native code to JavaScript code</a></li>
<li><a href="#sendaction">The SendAction sample</a></li>
<li><a href="#shared">Shared session</a></li>
<li><a href="#sample">Sample application</a></li>
</ul>
<h2 id="control">Taking control of the startup flow</h2>
<p>When you create a hybrid application, MobileFirst Platform generates an App Delegate (<code><em>YourAppName</em>.m</code>) which handles the various stages of the application startup flow, as follows:</p>
<ol>
<li>The <code>showSplashScreen</code> method is called to display a simple splash screen while resources are being loaded. <em>This is the location that can be modified with any native introduction screen.</em></li>
<li>The <code>initializeWebFrameworkWithDelegate</code> method loads the resources that the web view needs to work correctly.<br />
As soon as the web framework initialization finishes, the <code>wlInitWebFrameworkDidCompleteWithResult</code> method is called.</li>
<li>At this point, by default, the application is still displaying the splash screen and no web view is displayed yet.<br />
You can modify the implementation to handle more of the status codes that are returned by the framework.</li>
<p>By default, a successful load calls the <code>wlInitDidCompleteSuccessfully</code> method.</p>
<li>A Cordova web view controller (<code>CDVViewController</code> class) is initialized and the start page of the application is set.<br />
The Cordova controller is then added as a child to the root view and displayed on the screen.</li>
<li>If you decide to implement a custom introduction screen as explained before, consider delaying the display of the Cordova view until the user is done with the custom native screen.</li>
</ol>
<h2 id="splash">Native SplashScreen sample</h2>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/10/07_08_splashscreen_sample.png"><img src="{{ site.baseurl }}/assets/backup/07_08_splashscreen_sample.png" alt="07_08_splashscreen_sample" width="891" height="369" class="aligncenter size-full wp-image-1069" /></a></p>
<p>The NativeUIInHybrid project includes a hybrid application called NativeSplashScreen.<br />
This example uses a Page View Controller to show a sliding introduction to the application. The user interface was created using a Storyboard in XCode.<br />
Two classes, <code>PageViewController</code> and <code>PageContentViewController</code>, were created to handle the slides.</p>
<ol>
<li>In the <code>MyAppDelegate.didFinishLaunchingWithOptions</code> method, the window is initialized and the PageViewController instance is set as the root of the window.
<p>[code lang="obj-c" highlight="7-8"]@implementation MyAppDelegate<br />
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions<br />
{<br />
    //...<br />
    self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];</p>
<p>    PageViewController* pageViewController = [[UIStoryboard storyboardWithName:@&quot;Storyboard&quot; bundle: nil] instantiateViewControllerWithIdentifier:@&quot;PageViewController&quot;];<br />
    [self.window setRootViewController:pageViewController];<br />
    [self.window makeKeyAndVisible];</p>
<p>    //..<br />
}[/code]
</li>
<li>The <code>initializeWebFrameworkWithDelegate</code> method is called from within the <code>didFinishLaunchingWithOptions</code> method.<br />
This method initializes the MobileFirst framework in the background and calls the <code>wlInitWebFrameworkDidCompleteWithResult</code> method after the framework is initialized.</p>
<p>[code lang="obj-c" highlight="7"]@implementation MyAppDelegate<br />
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions<br />
{<br />
    //...<br />
    [self.window setRootViewController:pageViewController];<br />
    [self.window makeKeyAndVisible];<br />
    [[WL sharedInstance] initializeWebFrameworkWithDelegate:self];<br />
    return result;<br />
}[/code]
</li>
<li>Inside the <code>wlInitWebFrameworkDidCompleteWithResult</code> method, different scenarios are handled depending on the <code>statusCode</code> value of the <code>WLWebFrameworkInitResult</code> object.<br />
In this sample, only the common case of the <code>WLWebFrameworkInitResultSuccess</code> value is modified.</p>
<p>[code lang="obj-c"]-(void)wlInitWebFrameworkDidCompleteWithResult:(WLWebFrameworkInitResult *)result<br />
{<br />
    if ([result statusCode] == WLWebFrameworkInitResultSuccess) {<br />
        [self wlInitDidCompleteSuccessfully];<br />
    } else {<br />
        [self wlInitDidFailWithResult:result];<br />
    }<br />
}[/code]
</li>
<li>In the <code>wlInitDidCompleteSuccessfully</code> method, a Cordova controller is being prepared but is not displayed yet.<br />
Optionally, you can set the frame to itself so that the web view initializes in the background if initialization of the JavaScript code is required to start in the background.</p>
<p>[code lang="obj-c"]-(void)wlInitDidCompleteSuccessfully<br />
{<br />
    // Create a Cordova View Controller<br />
    self.cordovaViewController = [[CDVViewController alloc] init] ;<br />
    self.cordovaViewController.startPage = [[WL sharedInstance] mainHtmlFilePath];</p>
<p>    //This will trigger initialization in the background, optional<br />
    self.cordovaViewController.view.frame = self.cordovaViewController.view.frame;<br />
}[/code]
</li>
<li>In this sample, the <code>PageViewController</code> instance ends with a button that triggers a custom method called <code>onSplashScreenDone</code> in the AppDelegate.<br />
The <code>onSplashScreenDone</code> custom method resumes where the flow was interrupted and displays the previously initialized Cordova view.</p>
<p>[code lang="obj-c"]-(void)onSplashScreenDone {<br />
    UIViewController* rootViewController = [[UIViewController alloc] init];</p>
<p>    [self.window setRootViewController:rootViewController];<br />
    [self.window makeKeyAndVisible];</p>
<p>    self.cordovaViewController.view.frame = rootViewController.view.bounds;</p>
<p>    [rootViewController addChildViewController:self.cordovaViewController];<br />
    [rootViewController.view addSubview:self.cordovaViewController.view];<br />
}[/code]
</li>
</ol>
<h2 id="jsToNative">Sending commands from JavaScript code to native code</h2>
<p>In MobileFirst applications, commands are sent with parameters from the web view (via JavaScript) to a native class (written in Objective-C).<br />
You can use this feature to trigger native code to be run in the background, to update the native UI, to use native-only features, etc.</p>
<h3>Step 1</h3>
<p>In JavaScript, use the following API:<br />
<code>WL.App.sendActionToNative("doSomething", {customData: 12345});</code></p>
<ul>
<li><code>doSomething</code> is an arbitrary action name to be used on the native side (see the next step).</li>
<li>The second parameter is a JSON object that contains any data.</li>
</ul>
<h3>Step 2</h3>
<p>The native class to receive the action must implement the <code>WLActionReceiver</code> protocol:<br />
[code gutter="false"]@interface MyReceiver: NSObject &lt;WLActionReceiver&gt;[/code]</p>
<p>The <code>WLActionReceiver</code> protocol requires an <code>onActionReceived</code> method in which the action name can be checked for and perform any native code that the action needs:</p>
<p>[code lang="obj-c"]-(void) onActionReceived:(NSString *)action withData:(NSDictionary *) data {<br />
    if ([action isEqualToString:@&quot;doSomething&quot;]){<br />
       // perform required actions, e.g., update native user interface<br />
    }<br />
}[/code]</p>
<h3>Step 3</h3>
<p>For the action receiver to receive actions from the MobileFirst web view, it must be registered. The registration can be done during the startup flow of the application to catch any actions early enough:<br />
[code lang="obj-c"][[WL sharedInstance] addActionReceiver:[[myReceiver alloc] init]][/code]</p>
<h2 id="nativeToJs">Sending commands from native code to JavaScript code</h2>
<p>In MobileFirst applications, commands can be sent with parameters from native Objective-C code to the JavaScript code of web views.<br />
You can use this feature to receive responses from a native method, notify the web view when background code finished running, have a native UI control the content of the web view, etc.</p>
<h3>Step 1</h3>
<p>In Objective-C, the following API is used:<br />
[code lang="obj-c"]NSDictionary *data = @{@&quot;someProperty&quot;: @&quot;12345&quot;};<br />
[[WL sharedInstance] sendActionToJS:@&quot;doSomething&quot; withData:data];[/code]</p>
<ul>
<li><code>doSomething</code> is an arbitrary action name to be used on the JavaScript side.</li>
<li>The second parameter is an <code>NSDictionary</code> object that contains any data.</li>
</ul>
<h3>Step 2</h3>
<p>A JavaScript function, which verifies the action name and implements any JavaScript code.</p>
<p>[code lang="js"]function actionReceiver(received){<br />
  if (received.action == &quot;doSomething&quot; &amp;&amp; received.data.someProperty == &quot;12345&quot;){<br />
    //perform required actions, e.g., update web user interface<br />
  }<br />
}[/code]</p>
<h3>Step 3</h3>
<p>For the action receiver to receive actions, it must first be registered. This should be done early enough in the JavaScript code so that the function can handle those actions as early as possible.</p>
<p>[code lang="js"]WL.App.addActionReceiver (&quot;MyActionReceiverId&quot;, actionReceiver);[/code]</p>
<p>The first parameter is an arbitrary name. It can be used later to remove an action receiver.<br />
[code lang="js"]WL.App.removeActionReceiver(&quot;MyActionReceiverId&quot;);[/code]</p>
<h2 id="sendaction">The SendAction sample</h2>
<p><a href="https://developer.ibm.com/mobileplatform/wp-content/uploads/sites/32/2014/10/07_08_screenshot.png"><img src="{{ site.baseurl }}/assets/backup/07_08_screenshot.png" alt="07_08_screenshot" width="702" height="600" class="aligncenter size-full wp-image-1111" /></a></p>
<h3>Overview</h3>
<p>Download the NativeUIInHybrid project, which includes a hybrid application called SendAction.<br />
<strong>Note:</strong> This sample requires the MapKit framework.</p>
<p>This sample divides the screen in two parts.</p>
<ul>
<li>The top half is a Cordova web view with a form to enter a street address.</li>
<li>The bottom half is a native map view that shows the entered location if it is valid. If the address is invalid, the native map forwards the error to the web view, which displays it.</li>
</ul>
<h3>HTML</h3>
<p>The HTML page shows the following elements:</p>
<ul>
<li>A simple input field to enter an address</li>
<li>A button to trigger validation</li>
<li>An empty  line to show potential error messages</li>
</ul>
<p>[code lang="html"]&lt;p&gt;This is a MobileFirst WebView.&lt;/p&gt;<br />
&lt;p&gt;Enter a valid address (requires Internet connection):&lt;br/&gt;<br />
      &lt;input type=&quot;text&quot; name=&quot;address&quot; id=&quot;address&quot;/&gt;<br />
&lt;input type=&quot;button&quot; value=&quot;Display&quot; id=&quot;displayBtn&quot;/&gt;<br />
 &lt;/p&gt;<br />
 &lt;p id=&quot;errorMsg&quot; style=&quot;color:red;&quot;&gt;&lt;/p&gt;[/code]</p>
<h3>JavaScript</h3>
<p>When the button is clicked, the <code>sendActionToNative</code> method is called to send the address to the native code.</p>
<p>[code lang="js"]$('#displayBtn').on('click', function(){<br />
  $('#errorMsg').empty();<br />
  WL.App.sendActionToNative(&quot;displayAddress&quot;,<br />
        { address: $('#address').val()}<br />
    );<br />
  });[/code]</p>
<p>The code also registers an action receiver to display potential error messages from the native code.<br />
[code lang="js"]WL.App.addActionReceiver (&quot;MyActionReceiverId&quot;, function actionReceiver(received){<br />
    if(received.action == 'displayError'){<br />
      $('#errorMsg').html(received.data.errorReason);<br />
    }<br />
  });[/code]</p>
<h3>Storyboard</h3>
<p>The interface was designed with a Storyboard file. It features a generic view controller with the <code>ViewController</code> custom class (described later).</p>
<p>The view controller contains a <code>MKMapView</code> object and a Container View.<br />
The Container View contains a view controller, which is set to use the <code>HybridScreenViewController</code> class (described later).</p>
<p><a href="https://developer.ibm.com/mobileplatform/wp-content/uploads/sites/32/2014/10/07_08_storyboard.png"><img src="{{ site.baseurl }}/assets/backup/07_08_storyboard.png" alt="07_08_storyboard" width="718" height="360" class="aligncenter size-full wp-image-1104" /></a></p>
<h3>HybridScreenViewController</h3>
<p><code>HybridScreenViewController</code> extends <code>CDVViewController</code>, the Cordova web view provided by MobileFirst Platform (<code>@interface HybridScreenViewController : CDVViewController</code>).</p>
<p>The implementation of the class is almost empty, except for setting the <code>startPage</code> of the Cordova web view.</p>
<p>[code lang="obj-c"]@implementation HybridScreenViewController<br />
- (id)initWithCoder:(NSCoder*)aDecoder {<br />
    self = [super initWithCoder:aDecoder];<br />
    self.startPage = [[WL sharedInstance] mainHtmlFilePath];<br />
    return self;<br />
}<br />
//...[/code]</p>
<h3>ViewController</h3>
<p>The <code>ViewController</code> class extends <code>UIViewController</code>.<br />
This class:</p>
<ul>
<li>Contains a reference to the <code>MKMapView</code> object as a property.</li>
<li>Adheres to the <code>MKMapViewDelegate</code> protocol to receive updates about the map.</li>
<li>Adheres to the <code>WLActionReceiver</code> protocol to receive actions from the MobileFirst web view.</li>
<li>Contains a reference to a <code>CLGeocoder</code> object to enable geocoding addresses.</li>
</ul>
<p>[code lang="obj-c"]@interface ViewController ()&lt;MKMapViewDelegate, WLActionReceiver&gt;<br />
@property (weak, nonatomic) IBOutlet MKMapView *map;<br />
@property CLGeocoder* geocoder;<br />
@end[/code]</p>
<p>The title of the controller is set to be displayed as part of a <code>UINavigationController</code> object.<br />
The geocoder is initialized.<br />
The map delegate is set.<br />
The <code>ViewController</code> object is registered as an action receiver for MobileFirst.</p>
<p>[code lang="obj-c"]- (void)viewDidLoad<br />
{<br />
    [super viewDidLoad];<br />
    self.title = @&quot;This is a native header&quot;;<br />
    self.geocoder = [[CLGeocoder alloc] init];<br />
    [self.map setDelegate:self];<br />
    [[WL sharedInstance] addActionReceiver:self];<br />
}[/code]</p>
<p>The <code>onActionReceived</code> method is called when the user submits the form. The action name is checked and the entered address is retrieved.<br />
The geocoder is given the address.</p>
<p>[code lang="obj-c"]-(void) onActionReceived:(NSString *)action withData:(NSDictionary *) data {<br />
    if ([action isEqualToString:@&quot;displayAddress&quot;]<br />
        &amp;&amp; [data objectForKey:@&quot;address&quot;]){<br />
        NSString* address = (NSString*) [data objectForKey:@&quot;address&quot;];<br />
        [self.geocoder geocodeAddressString:address<br />
                    completionHandler:^(NSArray* placemarks, NSError* error){<br />
                              //DO STUFF - next slide...</p>
<p>                    }];<br />
    }<br />
}[/code]</p>
<p>If a location is found, the region is centered and a new <code>MKPlacemark</code> is added to the map.</p>
<p>[code lang="obj-c" highlight="10,13"]completionHandler:^(NSArray* placemarks, NSError* error){<br />
    if([placemarks count]){<br />
        CLPlacemark *topResult = [placemarks objectAtIndex:0];<br />
        float spanX = 0.00725;<br />
        float spanY = 0.00725;<br />
        MKCoordinateRegion region;<br />
        region.center.latitude = topResult.location.coordinate.latitude;<br />
        region.center.longitude = topResult.location.coordinate.longitude;<br />
        region.span = MKCoordinateSpanMake(spanX, spanY);<br />
        [self.map setRegion:region animated:YES];</p>
<p>        MKPlacemark *placemark = [[MKPlacemark alloc]initWithPlacemark:topResult];<br />
        [self.map addAnnotation:placemark];<br />
    }<br />
}[/code]</p>
<p>If the search fails or no location is found, the <code>sendActionToJS</code> method is called to transmit the error to the web view.</p>
<p>[code lang="obj-c" highlight="6"]completionHandler:^(NSArray* placemarks, NSError* error){<br />
    if([placemarks count]){<br />
        //...<br />
    }<br />
    else{<br />
        [[WL sharedInstance] sendActionToJS:@&quot;displayError&quot;<br />
                            withData:@{@&quot;errorReason&quot;: [error localizedDescription]}<br />
         ];<br />
    }<br />
}[/code]</p>
<h3>MyAppDelegate</h3>
<ul>
<li>The <code>didFinishLaunchingWithOptions</code> method of the app delegate is generated by MobileFirst Platform and is left unchanged in this example.</li>
<li>The <code>wlInitDidCompleteSuccessfully</code> status code is modified to load the <code>ViewController</code> object from the Storyboard instead of loading the <code>CDVViewController</code> object directly.</li>
<li>The splash screen is hidden in native code because JavaScript has not started yet.</li>
</ul>
<p>[code lang="obj-c" highlight="4,6"]-(void)wlInitDidCompleteSuccessfully<br />
{<br />
    UINavigationController* rootViewController = self.window.rootViewController;<br />
    ViewController* viewController = [[UIStoryboard storyboardWithName:@&quot;Storyboard&quot; bundle:nil] instantiateViewControllerWithIdentifier:@&quot;ViewController&quot;];<br />
    [rootViewController pushViewController:viewController animated:YES];<br />
    [[WL sharedInstance] hideSplashScreen];<br />
}[/code]</p>
<h2 id="shared">Shared session</h2>
<p>When you use both JavaScript and native code in the same application, you might need to make HTTP requests to MobileFirst Server (connection,  procedure invocation, etc.)</p>
<p>HTTP requests are explained in other tutorials about authentication, application authenticity, and HTTP adapters (both for hybrid and native applications).<br />
IBM Worklight Foundation 6.2, and IBM MobileFirst Platform Foundation 6.3 and later, keep your session (cookies and HTTP headers) automatically synchronized between the JavaScript client and the native client.</p>
<h2 id="sample">Sample application</h2>
<p><a href="https://github.com/MobileFirst-Platform-Developer-Center/NativeUIInHybrid" target="_blank">Click to download</a> the MobileFirst project.</p>
