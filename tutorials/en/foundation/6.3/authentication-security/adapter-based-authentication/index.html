---
layout: tutorial
title: Adapter-based authentication
show_children: true
---
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="ios"><a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-native-ios-development-6-3/">Native iOS</a></li>
<li class="android"><a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-native-android-development-6-3/">Native Android</a></li>
<li class="hybrid"><a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-hybrid-development-6-3/">Hybrid</a></li>
</ul>
</div>
<h2>Overview</h2>
<p>Adapter-based authentication is the most flexible type of authentication to implement and contains all the benefits of the IBM MobileFirst Platform Foundation Server authentication framework.</p>
<p>When you use adapter-based authentication, you can implement the entire authentication logic, including validation of the credentials, in an adapter by using plain JavaScript.</p>
<p>You can also use any login module as an extra authentication layer.</p>
<p>In this tutorial, an adapter-based authentication mechanism that relies on a user name and a password will be implemented.</p>
<p>Jump to:</p>
<ul>
<li><a href="#creatingTheClientsideAuthenticationComponents">Creating the client-side authentication components</a></li>
</ul>
<h2>Configuring the authenticationConfig.xml file</h2>
<h3>Realms</h3>
<p>Add two authentication realms to the <span class="inline-code">realms</span> section of the <strong>authenticationConfig.xml</strong> file.</p>
<p>[code lang="xml"]<br />
  <realm loginModule="AuthLoginModule" name="SingleStepAuthRealm"><br />
	<className>com.worklight.integration.auth.AdapterAuthenticator</className><br />
  	<parameter name="login-function" value="SingleStepAuthAdapter.onAuthRequired"/><br />
  	<parameter name="logout-function" value="SingleStepAuthAdapter.onLogout"/><br />
  </realm><br />
  <realm loginModule="AuthLoginModule" name="DoubleStepAuthRealm"><br />
  	<className>com.worklight.integration.auth.AdapterAuthenticator</className><br />
  	<parameter name="login-function" value="DoubleStepAuthAdapter.onAuthRequired"/><br />
  	<parameter name="logout-function" value="DoubleStepAuthAdapter.onLogout"/><br />
  </realm><br />
[/code]</p>
<p>These realms use the <span class="inline-code">AuthLoginModule</span> login module, which is defined later.<br />
Using the <span class="inline-code">com.worklight.integration.auth.AdapterAuthenticator</span> class means that the server-side part of the authenticator is defined in the adapter.<br />
Whenever the MobileFirst authentication framework detects an attempt to access a protected resource, an adapter function that is defined in a <strong>login-function</strong> parameter is called automatically.<br />
When logout is detected (explicit or session timeout), a <strong>logout-function</strong> is called automatically.<br />
In both cases, the parameter value syntax is <span class="inline-code">adapterName.functionName</span>.</p>
<h3>LoginModule</h3>
<p>Add a login module to the <span class="inline-code">loginModules</span> section of the <strong>authenticationConfig.xml</strong> file and call it <span class="inline-code">AuthLoginModule</span>.</p>
<p>[code lang="xml"]<br />
<loginModule name="AuthLoginModule"><br />
    <className>com.worklight.core.auth.ext.NonValidatingLoginModule</className><br />
</loginModule><br />
[/code]</p>
<p>Using a <span class="inline-code">NonValidatingLoginModule</span> class name means that no additional validation is performed by the MobileFirst platform, and the developer takes responsibility for the validation of credentials within the adapter.<br />
Because all authentication-related actions are done in the adapter code, using <span class="inline-code">NonValidatingLoginModule</span> is mandatory for adapter-based authentication.</p>
<h3>Security Tests</h3>
<p>Add security tests to the <span class="inline-code">securityTests</span> section of the <strong>authenticationConfig.xml</strong> file.<br />
You must use this security test to protect the adapter procedure, so use the <span class="inline-code">customSecurityTest</span> element.<br />
Remember the security test names. You must use them in subsequent steps.</p>
<p>[code lang="xml"]<br />
  <customSecurityTest name="SingleStepAuthAdapter-securityTest"><br />
      <test isInternalUserID="true" realm="SingleStepAuthRealm"/><br />
  </customSecurityTest><br />
  <customSecurityTest name="DoubleStepAuthAdapter-securityTest"><br />
      <test isInternalUserID="true" realm="DoubleStepAuthRealm"/><br />
  </customSecurityTest><br />
[/code]</p>
<h2>Creating the server-side authentication components</h2>
<p>The following diagram illustrates the adapter-based authentication process:<br />
<a href="https://developer.ibm.com/mobileplatform/wp-content/uploads/sites/32/2014/07/09_05_flow_diagram.png"><img class="aligncenter wp-image-972 size-full" src="{{ site.baseurl }}/assets/backup/09_05_flow_diagram.png" alt="09_05_flow_diagram" width="1360" height="729" /></a></p>
<h3>Adapter XML</h3>
<p>The sample that is provided with this training module uses two applications and two adapters. The <span class="inline-code">SingleStepAuth</span> application and adapter will be covered here. The <span class="inline-code">DoubleStepAuth</span> application and adapter are an extension of the same technique.</p>
<p>Create an adapter that takes care of the authentication process. Name it <strong>SingleStepAuthAdapter</strong>.<br />
The <strong>SingleStepAuthAdapter</strong> includes the following two procedures:</p>
<p>[code lang="xml"]<br />
<procedure name="submitAuthentication" securityTest="wl_unprotected"/><br />
<procedure name="getSecretData" securityTest="SingleStepAuthAdapter-securityTest"/><br />
[/code]</p>
<ul>
<li>The submitAuthentication procedure takes care of the authentication process. Note that when the challenge handler invokes the <code>submitAuthentication</code> call, it is responsible for handling all the possible responses. In particular, if the <code>submitAuthentication</code> call returns a challenge, it is passed to the invocation callback, and is not processed by the security framework.<br />
<br />
<strong>Note:</strong> It is required for the "submit" procedure to be unprotected by using the <code>wl_unprotected</code> security test.</li>
<li>The second procedure, however, is available to authenticated users only</li>
</ul>
<p>The following diagram shows the flow to implement:<br />
<a href="https://developer.ibm.com/mobileplatform/wp-content/uploads/sites/32/2014/07/09_05_flow_diagram2.png"><img class="aligncenter wp-image-973 size-full" src="{{ site.baseurl }}/assets/backup/09_05_flow_diagram2.png" alt="09_05_flow_diagram2" width="1340" height="679" /></a></p>
<h3>onAuthRequired</h3>
<p>Whenever the framework detects an unauthenticated attempt to access a protected resource, the <span class="inline-code">onAuthRequired</span> function is called, as defined in the <strong>authenticationConfig.xml</strong> file.</p>
<p>[code lang="javascript"]<br />
function onAuthRequired(headers, errorMessage){<br />
	errorMessage = errorMessage ? errorMessage : null;</p>
<p>	return {<br />
		authRequired: true,<br />
		errorMessage: errorMessage<br />
	};<br />
}<br />
[/code]</p>
<p>The returned object is a <strong>custom</strong> challenge object that is sent to the application.<br />
This function receives the request headers and an optional <span class="inline-code">errorMessage</span> parameter. The object that is returned by this function is sent to the client application.<br />
<strong>Note:</strong> In the sample, the <span class="inline-code">authRequired:true</span> property in the challenge handler detects that the server is requesting authentication.</p>
<h3>submitAuthentication</h3>
<p>The <span class="inline-code">submitAuthentication</span> function is called by a client application to validate the user name and password.</p>
<p>[code lang="javascript"]<br />
function submitAuthentication(username, password){<br />
	if (username==="user" &amp;&amp; password === "user"){</p>
<p>		var userIdentity = {<br />
				userId: username,<br />
				displayName: username,<br />
				attributes: {<br />
					foo: "bar"<br />
				}<br />
		};</p>
<p>		WL.Server.setActiveUser("SingleStepAuthRealm", userIdentity);</p>
<p>		return {<br />
			authRequired: false<br />
		};<br />
	}</p>
<p>	return onAuthRequired(null, "Invalid login credentials");<br />
}<br />
[/code]</p>
<p>The user name and password are received from the application as parameters. In this sample, the credentials are validated against some hardcoded values, but any other validation mode is valid, for example by using SQL or web services.<br />
If the validation passed successfully, the <span class="inline-code">WL.Server.setActiveUser</span> method is called to create an authenticated session for the <span class="inline-code">SingleStepAuthRealm</span>, with user data stored in a <span class="inline-code">userIdentity</span> object. You can add your own custom properties to the user identity attributes.<br />
An object (<span class="inline-code">{authRequired: false}</span>) is sent to the application, stating that the authentication screen is no longer required.<br />
If the credentials validation fails, an object that is built by the <span class="inline-code">onAuthRequired</span> function is returned to the application with a suitable error message.</p>
<h3>getSecretData</h3>
<p>For training purposes, the <span class="inline-code">getSecretData</span> function returns a hardcoded value. Keep in mind that <span class="inline-code">getSecretData</span> is protected by a security test, as defined in the adapter XML.</p>
<p>[code lang="javascript"]<br />
function getSecretData(){<br />
	return {<br />
		secretData: "Very very very very secret data"<br />
	};<br />
}<br />
[/code]</p>
<h3>onLogout</h3>
<p>The <span class="inline-code">onLogout</span> function is defined in the <strong>authenticationConfig.xml</strong> file to be called automatically after a logout, for example to perform a cleanup. This step is optional.</p>
<p>[code lang="javascript"]<br />
function onLogout(){<br />
	WL.Logger.debug("Logged out");<br />
}<br />
[/code]</p>
<h2 id="creatingTheClientsideAuthenticationComponents" class="noPrint">Creating the client-side authentication components</h2>
