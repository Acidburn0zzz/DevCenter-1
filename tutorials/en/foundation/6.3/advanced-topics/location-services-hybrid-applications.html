---
layout: doc_page
title: Location services in hybrid applications
date: 2014-07-23 06:29:33.000000000 +03:00
type: doc_page
published: true
status: publish
categories: []
tags: []
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '9037'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"984a002a47179f5ee40a1e2a09fbfe45";a:2:{s:7:"expires";i:1442507768;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:5607;}i:1;a:1:{s:2:"id";i:10963;}i:2;a:1:{s:2:"id";i:10967;}}}}
author:
  login: iadar@il.ibm.com
  email: IADAR@il.ibm.com
  display_name: IdanAdar
  first_name: IDAN
  last_name: ADAR
---
<p class="breadcrumbs">
&lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-6-3/advanced-topics/">Advanced topics</a></p>
<div id="samplesAndPersonas">
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="hybrid"><a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-hybrid-development-6-3/">Hybrid</a></li>
</ul></div>
<ul>
<li class="download-sample">
          <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/LocationServicesProject.zip">Download Studio project</a>
        </li>
</ul>
</div>
<h2>Architecture</h2>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/location_service_diagram.jpg"><img src="{{ site.baseurl }}/assets/backup/location_service_diagram.jpg" alt="location_service_diagram" width="650" height="404" class="aligncenter size-full wp-image-5171" /></a></p>
<p>The application code on the mobile device, in the form of an acquisition policy, controls the collection of data from device sensors.</p>
<p>The collected data is referred to as the device context.</p>
<p>When a change occurs in the device context, such as a change in the geolocation of the device or the fact that it entered a WiFi zone, triggers can be activated.</p>
<p>The triggers specify that an action should occur: either a callback function is called, or an event is sent to the server, based on the device context.</p>
<p>Events are created by triggers and application code, and include a snapshot of the device context at the time of their creation.</p>
<p>Events are buffered on the client, and are transmitted to the server periodically.</p>
<p>The server might process the event later.</p>
<p>During the event transmission process, the device context is synchronized transparently to the server.</p>
<p>To handle the events, the server uses adapter application code.</p>
<p>This code sets up event handlers on the server. These handlers filter event data and pass matching events to a callback function.</p>
<p>The code also accesses the client device context (its location and WiFi network information), and sets an application context.</p>
<p>Server activities and received events are logged, together with the device and application contexts, for future reporting and analytics.</p>
<h2>Basic API</h2>
<h3>Client JavaScript</h3>
<p>Note: The following functions should be called after the IBM MobileFirst Platform Foundation framework is initialized (within or after the <code>wlCommonInit()</code> function).<br />
[code lang="javascript"]<br />
WL.Device.startAcquisition(policy, triggers, onFailure)<br />
[/code]</p>
<ul>
<li><strong>policy</strong>: how do you acquire the sensor data?</li>
<li><strong>triggers</strong>: what do you act on and how?</li>
<li><strong>onFailure</strong>: how do you handle acquisition failures?</li>
</ul>
<h3>Server JavaScript</h3>
<p>[code lang="javascript"]<br />
WL.Server.setEventHandlers(eventHandlers);<br />
[/code]</p>
<p><strong>eventHandlers</strong>: what events do you act on and how?</p>
<h2>Acquisition Policy</h2>
<p>An acquisition policy defines how acquisition takes place.<br />
[code lang="javascript"]<br />
var policy = {<br />
  Geo: WL.Device.Geo.Profiles.LiveTracking(),<br />
  Wifi: {<br />
    interval: 10000,<br />
    accessPointFilters: {<br />
      [{<br />
        SSID: &quot;Net1&quot;<br />
      }, {<br />
        SSID: &quot;Net2&quot;,<br />
        MAC: &quot;*&quot;<br />
      }]<br />
    }<br />
  }<br />
};<br />
[/code]</p>
<h3>Geo Acquisition Policy</h3>
<p>[code lang="javascript" firstline="2"]<br />
  Geo: WL.Device.Geo.Profiles.LiveTracking(),<br />
[/code]<br />
<span class="inline-code">LiveTracking</span> is a preset profile that uses the most accurate settings to track the device.<br />
Additional configuration options include:</p>
<ul>
<li><span class="inline-code">RoughTracking</span></li>
<li><span class="inline-code">PowerSaving</span></li>
<li>Custom settings</li>
</ul>
<blockquote><p>For more information, see the topic "Setting an acquisition policy" of the user documentation.</p></blockquote>
<h3>Wifi Acquisition Policy</h3>
<p>[code lang="javascript" firstline="3"]<br />
  Wifi: {<br />
    interval: 10000,<br />
    accessPointFilters: {<br />
      [{<br />
        SSID: &quot;Net1&quot;<br />
      }, {<br />
        SSID: &quot;Net2&quot;,<br />
        MAC: &quot;*&quot;<br />
      }]<br />
    }<br />
  }<br />
[/code]</p>
<p><span class="inline-code">interval</span> is the polling interval, in milliseconds; WiFi polling is performed each interval.</p>
<p><span class="inline-code">accessPointFilters</span> are access points of interest.<br />
In the above example, the acquisition policy:</p>
<ul>
<li>Ignores everything except "Net1" and "Net2" – doing so assists in dynamic environments, such as when there are mobile hotspots.
</li>
<li>Considers all "Net1" access points as though they were one access point.
</li>
<li>Differentiates "Net2" access points by MAC address.
</li>
</ul>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_wifi-policy-example.png"><img src="{{ site.baseurl }}/assets/backup/10_04_wifi-policy-example.png" alt="10_04_wifi-policy-example" width="505" height="470" class="aligncenter size-full wp-image-1482" /></a></p>
<blockquote><p>For more information, see the topic "Setting an acquisition policy" of the user documentation.</p></blockquote>
<h2>Triggers</h2>
<p>[code lang="javascript"]<br />
var triggers = {<br />
  Geo: {<br />
    trigger1: {<br />
      type: &quot;Enter&quot;,<br />
      circle: {<br />
        longitude: -74.04444,<br />
        latitude: 40.689167,<br />
        radius: 100<br />
      },<br />
      callback: libertyAtLast,<br />
      eventToTransmit: {<br />
        event: {<br />
          bring: &quot;me&quot;,<br />
          your: &quot;huddledMasses&quot;<br />
        }<br />
      }<br />
    }<br />
  }<br />
};<br />
[/code]</p>
<p>You can setup triggers for</p>
<ul>
<li>Geo/Wifi fences (<span class="inline-code">Enter</span>, <span class="inline-code">Exit</span>, <span class="inline-code">Dwell Inside</span>, <span class="inline-code">Dwell Outside</span>)</li>
<li>Movement (Geo: <span class="inline-code">PositionChange</span>, WiFi: <span class="inline-code">VisibleAccessPointsChange</span>)</li>
<li>WiFi <span class="inline-code">Connect</span> / <span class="inline-code">Disconnect</span></li>
</ul>
<p>In the above example <em>trigger1</em> is an <strong>Enter</strong> trigger which is activated when entering the defined circle (longitude, latitude and radius).</p>
<p>When a trigger activates, it can call a callback function and/or create an event to be sent to the server.</p>
<blockquote><p>For more information, see the topic "Triggers" of user documentation.</p></blockquote>
<h2>Events</h2>
<h3>Client Side</h3>
<p>Events are generated by triggers (as explained above).<br />
[code lang="javascript" firstline="11"]<br />
      eventToTransmit: {<br />
        event: {<br />
          bring: &quot;me&quot;,<br />
          your: &quot;huddledMasses&quot;<br />
        }<br />
      }<br />
[/code]</p>
<p>Events can also be generated manually by calling the API:<br />
[code lang="javascript"]<br />
WL.Client.transmitEvent(event,immediate);<br />
[/code]</p>
<h3>Server-side</h3>
<p>In the adapter code, create event handlers by using:<br />
[code lang="javascript"]<br />
WL.Server.createEventHandler(filter, handlerFunction);<br />
[/code]<br />
Events that match filter will be passed to <span class="inline-code">handlerFunction</span>.<br />
Filter examples:</p>
<ul>
<li><span class="inline-code">{status: "platinum"}</span> – handle platinum members only</li>
<li><span class="inline-code">{hotel: { country: "USA" } }</span> – hotels in the USA</li>
<li><span class="inline-code">{}</span> – all events</li>
</ul>
<p>Register the event handlers by using:<br />
[code lang="javascript"]<br />
WL.Server.setEventHandlers([...]);<br />
[/code]</p>
<blockquote><p>For more information, see the topic "Working with geofences and triggers" of the user documentation.</p></blockquote>
<h2>Testing hybrid applications</h2>
<p>In order to test your application you might need to test the various triggers and error handling logic that your application uses.<br />
The <strong>Mobile Browser Simulator</strong> provides capabilities to simulate sensor data and errors.<br />
This can be accessed by right-clicking an application environment, and selecting the <strong>Preview</strong> option under the <strong>Run As</strong> menu.</p>
<h3>Geo testing</h3>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_geotesting.png"><img src="{{ site.baseurl }}/assets/backup/10_04_geotesting.png" alt="10_04_geotesting" width="397" height="566" class="aligncenter size-full wp-image-1489" /></a><br />
The Geolocation widget can be used to set a specific position through manual entry, or by clicking on the map.</p>
<p>A simple simulation mode is also provided by using the <strong>Step</strong> and <strong>Play</strong> buttons, which move the position in the simulated device at the given speed and in the direction of the given heading.</p>
<p>You can also simulate the generation of errors.</p>
<h3>WiFi Testing</h3>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_wifitesting.png"><img src="{{ site.baseurl }}/assets/backup/10_04_wifitesting.png" alt="10_04_wifitesting" width="415" height="391" class="aligncenter size-full wp-image-1490" /></a></p>
<p>The Network widget can be used to define simulated access points, configure their signal strengths, and simulate the connection or disconnection to an access point.<br />
You can also simulate the generation of errors.</p>
<h3>Scenarios</h3>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_scenarios.png"><img src="{{ site.baseurl }}/assets/backup/10_04_scenarios.png" alt="10_04_scenarios" width="420" height="418" class="aligncenter size-full wp-image-1491" /></a></p>
<p>The Scenario widget can be used to automatically simulate a user moving through an environment in a complex way.<br />
A scenario consists of:</p>
<ul>
<li>The path of the user, and the point when the user reaches each path point
</li>
<li>WiFi access points
</li>
<li>No GPS coverage zones
</li>
</ul>
<p>To open the scenario editor, use the <strong>Edit</strong> button.</p>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_scenario-edit-mode.png"><img src="{{ site.baseurl }}/assets/backup/10_04_scenario-edit-mode.png" alt="10_04_scenario-edit-mode" width="920" height="657" class="aligncenter size-full wp-image-1493" /></a></p>
<p>Enter a geolocation directly to move the map, or use the arrows to pan and +/- track to zoom.</p>
<p>Click <a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_path-icon.png"><img src="{{ site.baseurl }}/assets/backup/10_04_path-icon.png" alt="10_04_path-icon" width="35" height="36" class="alignnone size-full wp-image-1494 inline-image" /></a> to define the path of the user.</p>
<p>Click on the map to add each path point; double-click to add the last point.<br />
You can drag points to new locations.<br />
Click on a point to set the user's arrival time to that point, or to delete the whole path.</p>
<p>Click <a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_wifi-icon.png"><img src="{{ site.baseurl }}/assets/backup/10_04_wifi-icon.png" alt="10_04_wifi-icon" width="38" height="39" class="alignnone size-full wp-image-1496 inline-image" /></a> to add Wifi access points.</p>
<p>Click on the map and drag to set the area covered by the access point.<br />
Click an existing access point to change its SSID and MAC.<br />
After clicking, drag to move or resize.</p>
<p>Click <a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_zone-icon.png"><img src="{{ site.baseurl }}/assets/backup/10_04_zone-icon.png" alt="10_04_zone-icon" width="38" height="37" class="alignnone size-full wp-image-1497 inline-image" /></a> to add no-GPS zones.</p>
<p>Click on the map to add each vertex of the zone; double-click to add the last point.<br />
After clicking an existing zone, you can drag to move, resize, or rotate.</p>
<p>When playing a scenario, the position of the user is displayed on the map ( <a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_user-icon.png"><img src="{{ site.baseurl }}/assets/backup/10_04_user-icon.png" alt="10_04_user-icon" width="24" height="24" class="alignnone size-full wp-image-1498 inline-image" /></a> ) and is automatically updated. The position that is available to the device is shown in the Geolocation widget (and will not change when in a no-GPS zone).<br />
WiFi access point visibility and signal strengths are automatically updated. These updates can be seen in the Network widget.<br />
Scenarios can be imported and exported to support test reuse.</p>
<h2>Sample</h2>
<p>The LocationServices sample demonstrates:</p>
<ul>
<li>Acquiring an initial position
</li>
<li>Using a Geo profile
</li>
<li>Geo Triggers for: DwellInside, Exit area, and PositionChange
</li>
<li>Transmitting event to the server on DewllInside and Exit area
</li>
<li>Ongoing acquisition
</li>
</ul>
<h2>Sample application</h2>
<p><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/LocationServicesProject.zip">Click to download</a> the Studio project.</p>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/10_04_sample.png"><img src="{{ site.baseurl }}/assets/backup/10_04_sample.png" alt="10_04_sample" width="338" height="600" class="aligncenter size-full wp-image-1500" /></a></p>
