---
layout: tutorial
title: SQL adapter - Communicating with SQL database
relevantTo: [ios,android,windowsphone8,hybrid]
---
<ul>
<li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/MobileFirstAdaptersProject.zip">Download Studio project</a>
    </li>
</ul>

<h2>Overview</h2>
<p>An IBM MobileFirst Platform Foundation SQL adapter is designed to communicate with any SQL data source.<br />
You can use plain SQL queries or stored procedures.<br />
As a developer, you must download the JDBC connector driver for the specific database type separately and add it to the <strong>server\lib\</strong> folder of a MobileFirst project.<br />
You can download the JDBC connector driver from the appropriate vendor website.<br />
In this tutorial and in the accompanying sample, you learn how to use a MobileFirst adapter to connect to a MySQL database.</p>
<h2>Creating the adapter</h2>
<p><img src="{{ site.baseurl }}/assets/backup/04_03_create-adapter.png"/></p>
<p><img src="{{ site.baseurl }}/assets/backup/04_03-filestruct.png"/></p>
<ol>
<li>In MobileFirst Studio, create a MobileFirst adapter and choose the SQL adapter type.<br />
A standard SQL adapter file structure is created.
</li>
<li>Save the downloaded JDBC connector file in the project <strong>server\lib\</strong> folder.<br />
<br clear="all" />
</li>
</ol>
<h2>Adapter XML</h2>
<p>Settings and metadata are stored in the adapter XML file.<br />
You can use either the Design or the Source editor to modify the adapter XML file.<br />
<img src="{{ site.baseurl }}/assets/backup/04_03_visual-xml.png"/></p>
<ol>
<li>In the adapter XML file, declare the following parameters:
<p>- Driver Class<br />
- Database URL<br />
- Username<br />
- Password</p>
<p>[code lang="xml"]<br />
	<connectivity&gt;<br />
		<connectionPolicy xsi:type="sql:SQLConnectionPolicy"&gt;<br />
			<dataSourceDefinition&gt;<br />
				<driverClass&gt;com.mysql.jdbc.Driver</driverClass&gt;<br />
				<url&gt;jdbc:mysql://localhost:3306/mobilefirst_training</url&gt;<br />
			    <user&gt;mobilefirst</user&gt;<br />
    			<password&gt;mobilefirst</password&gt;<br />
			</dataSourceDefinition&gt;<br />
		</connectionPolicy&gt;<br />
	</connectivity&gt;<br />
[/code]</p>
</li>
<li>Declare a procedure in the adapter XML file.
<p>[code lang="xml"]<br />
<procedure name="getAccountTransactions1"/&gt;<br />
[/code]
</li>
</ol>
<h2>JavaScript Implementation File</h2>
<p>The adapter JavaScript file is used to implement the procedure logic.</p>
<p><strong>Important:</strong> The name that is declared in the XML file must be used for the procedure JavaScript function.</p>
<p>There are two ways of running SQL statements:</p>
<ul>
<li>SQL statement query</li>
<li>SQL stored procedure</li>
</ul>
<p>Use the <code>WL.Server.createSQLStatement</code> method to prepare a SQL query.<br />
The <code>WL.Server.createSQLStatement</code> method must always be called outside the function.<br />
Add more parameters, if necessary.</p>
<p>[code lang="javascript"]<br />
//Create SQL query<br />
var getAccountsTransactionsStatement = WL.Server.createSQLStatement(<br />
	"SELECT transactionId, fromAccount, toAccount, transactionDate, transactionAmount, transactionType " +<br />
	"FROM accounttransactions " +<br />
	"WHERE accounttransactions.fromAccount = ? OR accounttransactions.toAccount = ? " +<br />
	"ORDER BY transactionDate DESC " +<br />
	"LIMIT 20;"<br />
);<br />
[/code]</p>
<p>Use the <code>WL.Server.invokeSQLStatement</code> method to call prepared queries.<br />
Return the result to the application or to another procedure.</p>
<p>[code lang="javascript"]<br />
//Invoke prepared SQL query and return invocation result<br />
function getAccountTransactions1(accountId){<br />
	return WL.Server.invokeSQLStatement({<br />
		preparedStatement : getAccountsTransactionsStatement,<br />
		parameters : [accountId, accountId]<br />
	});<br />
}<br />
[/code]</p>
<p>To run a SQL stored procedure, use the <code>WL.Server.invokeSQLStoredProcedure</code> method.<br />
Specify a SQL stored procedure name as an invocation parameter.<br />
Add more parameters, if necessary.<br />
Return the invocation result to the application or to another procedure.</p>
<p>[code lang="javascript"]<br />
//Invoke stored SQL procedure and return invocation result<br />
function getAccountTransactions2(accountId){<br />
	return WL.Server.invokeSQLStoredProcedure({<br />
		procedure : "getAccountTransactions",<br />
		parameters : [accountId]</p>
<p>	});<br />
}<br />
[/code]</p>
<h2>Invocation Results</h2>
<p>[code lang="javascript"]<br />
{<br />
  "isSuccessful": true,<br />
  "resultSet": [{<br />
    "fromAccount": "12345",<br />
    "toAccount": "54321",<br />
    "transactionAmount": 180.00,<br />
    "transactionDate": "2009-03-11T11:08:39.000Z",<br />
    "transactionId": "W06091500863",<br />
    "transactionType": "Funds Transfer"<br />
  }, {<br />
    "fromAccount": "12345",<br />
    "toAccount": null,<br />
    "transactionAmount": 130.00,<br />
    "transactionDate": "2009-03-07T11:09:39.000Z",<br />
    "transactionId": "W214122\/5337",<br />
    "transactionType": "ATM Withdrawal"<br />
  }]<br />
}<br />
[/code]</p>
<p>The result is retrieved as a JSON object.<br />
The <code>isSuccessful</code> property defines whether the invocation was successful.<br />
The <code>resultSet</code> object is an array of returned records.<br />
To access the <code>resultSet</code> object on the client-side: <code>result.invocationResult.resultSet</code><br />
To access the <code>resultSet</code> object on the server-side: <code>result.ResultSet</code></p>
<h2>Sample application</h2>
<p>The attached sample project contains an SQL adapter.</p>
<p>To run the sample, execute the <strong>mobilefirstTraining.sql</strong> file (which you can find under the Server folder of the sample) on your local MySQL server.<br />
Make sure that the mobilefirst@% user has all access permissions that are assigned to it.</p>
<p>Remember to download and set a MySQL Java Connector in your project.</p>
<p><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/MobileFirstAdaptersProject.zip">Click to download</a> the Studio project.</p>
