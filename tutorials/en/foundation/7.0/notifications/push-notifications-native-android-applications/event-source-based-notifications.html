---
layout: tutorial
title: Event source-based notifications in native Windows 8 applications
date: 2015-01-07 10:48:38.000000000 +02:00
type: tutorial
published: true
status: publish
categories: []
tags:
- 7-0
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
author:
  login: nathanh@il.ibm.com
  email: NATHANH@il.ibm.com
  display_name: Nathan Hazout
  first_name: NATHAN
  last_name: HAZOUT
---
<p class="breadcrumbs">
 &lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-7-0/notifications">Notifications</a> &lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-7-0/notifications/push-notification-native-android-applications/">Push notifications in native Android applications</a>
</p>

<div id="samplesAndPersonas">
<div>
    Relevant to:
    <ul id="relevantForPersona">
        <li class="android">Native Android</li>
    </ul>
</div>
<ul>
    <li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/PushNotificationsNativeProject.zip">Download Studio project</a>
    </li>
    <li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/AndroidNativePushProject.zip">Download native project</a>
    </li>
  </ul>
</div>

<h2>Overview</h2>
Event source notifications are notification messages that are targeted to devices with a user subscription.

To learn more about the architecture and terminology of push notifications in MobileFirst Platform, refer to the “<a href="/mobilefirstplatform/documentation/getting-started-7-0/notifications/push-notifications-hybrid-applications/event-source-based-notifications/">Event source-based notifications in hybrid applications</a>” tutorial.

Go to:
<ul>
    <li><a href="#serverSideApi">Notification API - Server-side</a></li>
    <li><a href="#clientSideApi">Notification API - Client-side</a></li>
    <li><a href="#sample">Sample application</a></li>
</ul>

<h2 id="serverSideApi">Notification API: Server-side</h2>

<h3>Creating an event source</h3>
Create a notification event source in the adapter JavaScript™ code at a global level (outside any JavaScript function).
[code lang="js"]
WL.Server.createEventSource({
    name: 'PushEventSource',
    onDeviceSubscribe: 'deviceSubscribeFunc',
    onDeviceUnsubscribe: 'deviceUnsubscribeFunc',
    securityTest:'PushApplication-strong-mobile-securityTest'
});
[/code]

<ul>
<li><code>name</code> – A name by which the event source is referenced.</li>
<li><code>onDeviceSubscribe</code> – An adapter function that is called when the request for user subscription is received.</li>
<li><code>onDeviceUnsubscribe</code> – An adapter function that is called when the request for user unsubscription is received.</li>
<li><code>securityTest</code> – A security test from the <code>authenticationConfig.xml</code> file that is used to protect the event source.</li></ul>

<h3>Sending a notification</h3>

Notifications can be either pulled from, or pushed by, the back-end system. In this example, a <code>submitNotifications()</code> adapter function is invoked by a back-end system as an external API to send notifications.

[code lang="js"]function submitNotification(userId, notificationText) {
    var userSubscription = WL.Server.getUserNotificationSubscription('PushAdapter.PushEventSource', userId);

    if (userSubscription === null) {
        return { result: "No subscription found for user :: " + userId };
    }

    var badgeDigit = 1;
    var notification = WL.Server.createDefaultNotification(notificationText, badgeDigit, {custom:"data"});

        WL.Server.notifyAllDevices(userSubscription, notification);

    return {
        result: "Notification sent to user :: " + userId
    };
}[/code]

<h2 id="clientSideApi">Notification API - Client-side</h2>

The first step is to create an instance of the <code>WLClient</code> class:

[code lang="java"]final WLClient client = WLClient.createInstance(this);[/code]

You derive all push notification operations from the <code>WLPush</code> class.

<ul>
<code>getPush</code>  –  Use this method to retrieve an instance of the <code>WLPush</code> class from the <code>WLClient</code> instance.

[code lang="java"]WLPush push = client.getPush();[/code]

<code>WLOnReadyToSubscribeListener</code> – When connecting to MobileFirst Server, the application attempts to register itself with the GCM server to receive push notifications.

[code lang="java"]
client.getPush().setOnReadyToSubscribeListener(listener);
client.connect(listener);
[/code]

The <code>onReadyToSubscribe</code> method of <code>WLOnReadyToSubscribeListener</code> is called when the registration is complete.


[code lang="java"]
@Override
public void onReadyToSubscribe() {.....}
[/code]
</ul>

<h3><code>WLPush.registerEventSourceCallback</code></h3>

To register an alias on a particular event source, use the <code>WLPush.registerEventSourceCallback</code> method.

The API takes the following arguments:

<ul>
<code>alias</code> - An alias name.
<code>Adaptername</code> - Adapter in which the event source is defined.
<code>EventSourceName</code> - The event source on which the alias is called.
</ul>

Example:

[code lang="java"]
WLClient.getInstance().getPush().registerEventSourceCallback("myAndroid","PushAdapter","PushEventSource",this);
[/code]

Typically, this method is called in the <code>onReadyToSubscribe</code> callback function.

[code lang="java"]@Override
public void onReadyToSubscribe() {
   WLClient.getInstance().getPush().registerEventSourceCallback("myAndroid","PushAdapter","PushEventSource",this);
}[/code]

<br clear="all"/>

<h4>In the Android activity class, override the methods that define the Android activity life cycle as follows:</h4>

<ul>


<code>onPause()</code> must call the <code>setForeground(false)</code> method of the <code>WLPush</code> instance to receive the notification in the notification bar when the application is paused.

[code lang="java"]
@Override
protected void onPause() {
    super.onPause();
    if (push != null)
    push.setForeground(false);
}
[/code]

<code>onResume()</code> must call the <code>setForeground(true)</code> method of the <code>WLPush</code> instance to receive the notification in the callback of the application.

[code lang="java"]
@Override
protected void onResume() {
    super.onResume();
    if (push != null)
    push.setForeground(true);
}
[/code]

<code>onDestroy()</code> must call the <code>unregisterReceivers</code> method of the <code>WLPush</code> instance to avoid leak exceptions from the receiver when the application exits.

[code lang="java"]
@Override
protected void onDestroy() {
    super.onDestroy();
    if (push != null)
    push.unregisterReceivers();
}
[/code]
</ul>

<h3>Subscribing to push notifications</h3>

To set up subscription to push notifications, use the <code>WLPush.subscribe(alias, pushOptions, responseListener)</code> API.

The API takes the following arguments:

<ul>

<code>alias</code> – The alias to which the device must subscribe.
<code>pushOptions</code> – An object of type <code>WLPushOptions</code>.
<code>responseListener</code> – An object of type <code>WLResponseListener</code>, which is called when subscription completes.
</ul>

Example:

[code lang="java"]
WLClient client = WLClient.getInstance();
client.getPush().subscribe("myAndroid",new WLPushOptions(), new MyListener(MyListener.MODE_SUBSCRIBE));
[/code]

MyListener Implements <code>WLResponseListener</code> and provides the following callback functions:

<ul>

<code>onSuccess</code> – Called when subscription succeeds.
<code>onFailure</code> – Called when subscription fails.

</ul>

<h3>Unsubscribing from push notifications</h3>

To set up unsubscription from push notifications, use the <code>WLPush.unsubscribe(alias, responseListener)</code> API.

The API takes the following arguments:

<ul>

<code>alias</code> – The alias to which the device has subscribed.
<code>responseListener</code> – An object of type <code>WLResponseListener</code>, which is called when unsubscription completes.
</ul>

Example:

[code lang="java"]
WLClient client = WLClient.getInstance();
client.getPush().unsubscribe("myAndroid",new MyListener(MyListener.MODE_UNSUBSCRIBE));
[/code]

MyListener Implements <code>WLResponseListener</code> and provides the following callback functions:

<ul>

<code>onSuccess</code> – Called when unsubscription succeeds.
<code>onFailure</code> – Called when unsubscription fails.

</ul>

<h3>Additional client-side API methods:</h3>

<code>isPushSupported()</code> - Indicates whether push notifications are supported by the device.

[code lang="java"]
WLClient client = WLClient.getInstance();
boolean supported = client.getPush().isPushSupported();
[/code]

<code>isSubscribed()</code> - Indicates whether the device is subscribed to push notifications.

[code lang="java"]
WLClient client = WLClient.getInstance();
boolean bIsSubscribed = client.getPush().isSubscribed("myAndroid");
[/code]

<h3>Receiving a push notification</h3>

When a push notification is received, the <code>onReceive</code> method is called on an <code>WLEventSourceListener</code> instance.

[code lang="java"]
public class MyListener implements WLOnReadyToSubscribeListener, WLResponseListener, WLEventSourceListener{
[/code]

The <code>WLEventSourceListener</code> instance is registered during the <code>registerEventSourceCallback</code> callback.

[code lang="java"]
WLClient.getInstance().getPush().registerEventSourceCallback("myAndroid", "PushAdapter","PushEventSource", this );
[/code]

The <code>onReceive</code> method displays the received notification on the screen.

[code lang="java"]
@Override
public void onReceive(String arg0, String arg1) {
    AndroidNativePush.updateTextView("Notification received  " + arg0);
}
[/code]

If the application is not running, the notification icon appears on the notification bar at the top of the screen.


<h2 id="sample">Sample application</h2>
<a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/PushNotificationsNativeProject.zip">Click to download</a> the Studio project.
<a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/AndroidNativePushProject.zip">Click to download</a> the Native project.

The sample contains two projects:

<ul>
    <li>The <strong>PushNotificationsNativeProject.zip</strong> file contains a MobileFirst native API that you can deploy to your MobileFirst Server instance.</li>
    <li>The <strong>AndroidNativePushProject.zip</strong> file contains a native iOS application that uses a MobileFirst native API library to subscribe to push notifications and receive notifications from GCM.
Make sure to update the <code>wlclient.properties</code> file in AndroidNativePushProject with the relevant server settings.</li>
</ul>

<a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushRun.png"><img src="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushRun.png" alt="NativeAndroidPushRun" width="1126" height="629" class="alignnone size-full wp-image-3035" /></a>

In MobileFirst Studio, right-click <strong>Push Adapter</strong> and select <strong>Run As > Invoke MobileFirst Procedure</strong>.

Call <code>submitNotification</code> to send a push notification.

<a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/nativeiOSSendnotificationmobilefirst.png"><img src="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/nativeiOSSendnotificationmobilefirst.png" alt="nativeiOSSendnotificationmobilefirst" width="596" height="389" class="alignnone size-full wp-image-3961" /></a>

<em>Push notification received - application in background</em>
<a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushNotificationReceivedAppBackground.png"><img src="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushNotificationReceivedAppBackground.png" alt="NativeAndroidPushNotificationReceivedAppBackground" width="373" height="30" class="alignnone size-full wp-image-2978" /></a>

<em>Push notification received - application in foreground</em>

<a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushReceivedNotification.png"><img src="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/NativeAndroidPushReceivedNotification.png" alt="NativeAndroidPushReceivedNotification" width="373" height="631" class="alignnone size-full wp-image-2980" /></a>
