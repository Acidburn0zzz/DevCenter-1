---
layout: tutorial
title: JSONStore – JavaScript API
date: 2014-12-17 09:00:23.000000000 +02:00
type: tutorial
published: true
status: publish
categories: []
tags:
- 7-0
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"984a002a47179f5ee40a1e2a09fbfe45";a:2:{s:7:"expires";i:1442501809;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:10677;}i:1;a:1:{s:2:"id";i:10679;}i:2;a:1:{s:2:"id";i:10681;}}}}
author:
  login: y.nunez@floms.com
  email: yoel@nunez.guru
  display_name: Yoel Nunez
  first_name: YOEL
  last_name: NUNEZ
---
<div id="samplesAndPersonas">
<div>
<p>Relevant to:</p>
<ul id="relevantForPersona">
<li class="hybrid">Hybrid</li>
</ul>
</div>
<ul>
<li class="download-sample"><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/JSONStoreAPIBasicsProject.zip">Download Studio project</a></li>
</ul>
</div>
<p><img class="alignright size-full wp-image-9247" src="{{ site.baseurl }}/assets/backup/jsonstore-hybridproject.png" alt="jsonstore-hybridproject" width="353" height="502" /></p>
<p>This tutorial covers the following topics</p>
<ul>
<li><a href="#what-is">What is JSONStore?</a></li>
<li><a href="#add-feature">Add JSONStore Feature</a></li>
<li>Basic Usage
<ul>
<li><a href="#init">Initalize</a></li>
<li><a href="#get">Get</a></li>
<li><a href="#add">Add</a></li>
<li><a href="#find">Find</a></li>
<li><a href="#replace">Replace</a></li>
<li><a href="#remove">Remove</a></li>
<li><a href="#remove-collection">Remove Collection</a></li>
<li><a href="#destroy">Destroy</a></li>
</ul>
</li>
<li>Advanced Usage
<ul>
<li><a href="#security">Security</a></li>
<li><a href="#multi-user">Multiple User Support</a></li>
<li><a href="#adapter">MobileFirst Adapter Integration</a></li>
<li><a href="#enhance">Enhance</a></li>
</ul>
</li>
<li><a href="#sample">Sample application</a></li>
<li><a href="#info">For more information</a></li>
</ul>
<h2 id="what-is">What is JSONStore?</h2>
<p>JSONStore is a lightweight, document-oriented storage system that is included as a feature of IBM® MobileFirst Platform Foundation, and enables persistent storage of JSON documents. Documents in an application are available in JSONStore even when the device that is running the application is offline. This persistent, always-available storage can be useful to access documents when, for example, there is no network connection to the device.</p>
<h2 id="add-feature">Add JSONStore Feature</h2>
<p>To add JSONStore to your hybrid environment open the <code>application-descriptor.xml</code> simply add <code>&lt;JSONStore/&gt;</code> under the <code>&lt;features&gt;&lt;/features&gt;</code> element.</p>
<p>[code lang="xml" highlight="24"]<br />
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;<br />
&lt;!--<br />
    COPYRIGHT LICENSE: This information contains sample code provided in source code form. You may copy, modify, and distribute<br />
	these sample programs in any form without payment to IBM® for the purposes of developing, using, marketing or distributing<br />
	application programs conforming to the application programming interface for the operating platform for which the sample code is written.<br />
	Notwithstanding anything to the contrary, IBM PROVIDES THE SAMPLE SOURCE CODE ON AN &quot;AS IS&quot; BASIS AND IBM DISCLAIMS ALL WARRANTIES,<br />
	EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, ANY IMPLIED WARRANTIES OR CONDITIONS OF MERCHANTABILITY, SATISFACTORY QUALITY,<br />
	FITNESS FOR A PARTICULAR PURPOSE, TITLE, AND ANY WARRANTY OR CONDITION OF NON-INFRINGEMENT. IBM SHALL NOT BE LIABLE FOR ANY DIRECT,<br />
	INDIRECT, INCIDENTAL, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR OPERATION OF THE SAMPLE SOURCE CODE.<br />
	IBM HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS OR MODIFICATIONS TO THE SAMPLE SOURCE CODE.</p>
<p> --&gt;<br />
&lt;application xmlns=&quot;http://www.worklight.com/application-descriptor&quot; id=&quot;JSONStoreAPI&quot; platformVersion=&quot;7.0.0.00.20150312-0731&quot;&gt;<br />
    &lt;displayName&gt;JSONStoreAPI&lt;/displayName&gt;<br />
    &lt;description&gt;JSONStoreAPI&lt;/description&gt;<br />
    &lt;author&gt;<br />
        &lt;name&gt;application's author&lt;/name&gt;<br />
        &lt;email&gt;application author's e-mail&lt;/email&gt;<br />
        &lt;homepage&gt;http://mycompany.com&lt;/homepage&gt;<br />
        &lt;copyright&gt;Copyright My Company&lt;/copyright&gt;<br />
    &lt;/author&gt;<br />
    &lt;mainFile&gt;index.html&lt;/mainFile&gt;<br />
    &lt;features&gt;<br />
        &lt;JSONStore/&gt;<br />
    &lt;/features&gt;<br />
    &lt;thumbnailImage&gt;common/images/thumbnail.png&lt;/thumbnailImage&gt;<br />
    &lt;iphone bundleId=&quot;com.JSONStoreAPI&quot; version=&quot;1.0&quot;&gt;<br />
        &lt;worklightSettings include=&quot;false&quot;/&gt;<br />
        &lt;security&gt;<br />
            &lt;encryptWebResources enabled=&quot;false&quot;/&gt;<br />
            &lt;testWebResourcesChecksum enabled=&quot;false&quot; ignoreFileExtensions=&quot;png, jpg, jpeg, gif, mp4, mp3&quot;/&gt;<br />
        &lt;/security&gt;<br />
    &lt;/iphone&gt;<br />
    &lt;android version=&quot;1.0&quot;&gt;<br />
        &lt;worklightSettings include=&quot;false&quot;/&gt;<br />
        &lt;security&gt;<br />
            &lt;encryptWebResources enabled=&quot;false&quot;/&gt;<br />
            &lt;testWebResourcesChecksum enabled=&quot;false&quot; ignoreFileExtensions=&quot;png, jpg, jpeg, gif, mp4, mp3&quot;/&gt;<br />
            &lt;publicSigningKey&gt;Replace this text with the actual public signing key of the certificate used to sign the APK, available by using the 'Extract public signing key' wizard.&lt;/publicSigningKey&gt;<br />
            &lt;packageName&gt;Replace this text with the actual package name of the application, which is the value of the 'package' attribute in the 'manifest' element in AndroidManifest.xml file.&lt;/packageName&gt;<br />
        &lt;/security&gt;<br />
    &lt;/android&gt;<br />
    &lt;windowsPhone8 version=&quot;1.0&quot;&gt;<br />
        &lt;uuid&gt;e5eeea5c-4c80-40d4-b250-c8f2e8698138&lt;/uuid&gt;<br />
    &lt;/windowsPhone8&gt;<br />
    &lt;windows8 version=&quot;1.0&quot;&gt;<br />
        &lt;uuid&gt;802f8287-a3f7-4dc5-ac17-0da638074763&lt;/uuid&gt;<br />
    &lt;/windows8&gt;<br />
&lt;/application&gt;<br />
[/code]</p>
<p>Alternatively, you can use the <strong>Application Descriptor Editor</strong> click <strong>Optional Features > Add > JSONStore > OK</strong></p>
<p><img src="{{ site.baseurl }}/assets/backup/jsonstore-hybrid-optional-features.png" alt="jsonstore-hybrid-optional-features" width="600" class="aligncenter size-medium wp-image-10002" /></p>
<p><img src="{{ site.baseurl }}/assets/backup/jsonstore-hybrid-feature.png" alt="jsonstore-hybrid-feature" width="300" height="297" class="aligncenter size-medium wp-image-10001" /></p>
<p><img src="{{ site.baseurl }}/assets/backup/jsonstore-hybrid-done.png" alt="jsonstore-hybrid-done" width="600" class="aligncenter size-medium wp-image-10000" /></p>
<h2 id="init">Initialize</h2>
<p>Use <code>init</code> to start one or more JSONStore collections</p>
<p>Starting or provisioning a collections means creating the persistent storage that contains the collection and documents, if it does not exists.</p>
<p>If the persistent storage is encrypted and a correct password is passed, the necessary security procedures to make the data accessible are run.</p>
<p>For optional features that you can enable at initialization time, see <strong>Security, Multiple User Support,</strong> and <strong>MobileFirst Adapter Integration</strong> in the second part of this module</p>
<p>[code lang="javascript"]<br />
var collections = {<br />
  people : {<br />
    searchFields: {name: 'string', age: 'integer'}<br />
  }<br />
};</p>
<p>WL.JSONStore.init(collections).then(function (collections) {<br />
  // handle success - collection.people (people's collection)<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="get">Get</h2>
<p>Use <code>get</code> to create an accessor to the collection. You must call <code>init</code> before you call get otherwise the result of get is undefined</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';</p>
<p>var people = WL.JSONStore.get(collectionName);<br />
[/code]</p>
<p>The variable <code>people</code> can now be used to perform operations on the <code>people</code> collection such as <code>add</code>, <code>find</code>, and <code>replace</code></p>
<h2 id="add">Add</h2>
<p>Use <code>add</code> to store data as documents inside a collection</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';<br />
var options = {};</p>
<p>var data = {name: 'yoel', age: 23};</p>
<p>WL.JSONStore.get(collectionName).add(data, options).then(function () {<br />
 // handle success<br />
}).fail(function (error) {<br />
 // handle failure<br />
});<br />
[/code]</p>
<h2 id="find">Find</h2>
<p>Use <code>find</code> to locate a document inside a collection by using a query. Use <code>findAll</code> to retrieve all the documents inside a collection. Use <code>findById</code> to search by the document unique identifier. The default behavior for find is to do a "fuzzy" search</p>
<p>[code language="javascript"]</p>
<p>var query = {name: 'yoel'};</p>
<p>var collectionName = 'people';</p>
<p>var options = {<br />
  exact: false, //default<br />
  limit: 10 // returns a maximum of 10 documents, default: return every document</p>
<p>};</p>
<p>WL.JSONStore.get(collectionName).find(query, options).then(function (results) {<br />
  // handle success - results (array of documents found)<br />
}).fail(function (error) {<br />
  // handle failure<br />
});</p>
<p>[/code]</p>
<h2 id="replace">Replace</h2>
<p>Use <code>replace</code> to modify documents inside a collection. The field that you use to perform the replacement is <code>_id,</code> the document unique identifier.</p>
<p>[code language="javascript"]</p>
<p>var document = {<br />
  _id: 1, json: {name: 'chevy', age: 23}<br />
};</p>
<p>var collectionName = 'people';</p>
<p>var options = {};</p>
<p>WL.JSONStore.get(collectionName).replace(document, options).then(function (numberOfDocsReplaced) {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});</p>
<p>[/code]</p>
<p>This examples assumes that the document <code>{_id: 1, json: {name: 'yoel', age: 23} }</code> is in the collection</p>
<h2 id="remove">Remove</h2>
<p>Use <code>remove</code> to delete a document from a collection</p>
<p>Documents are not erased from the collection until you call push. For more information, see the <strong>MobileFirst Adapter Integration</strong> section later in this tutorial</p>
<p>[code language="javascript"]<br />
var query = {_id: 1};</p>
<p>var collectionName = 'people';</p>
<p>var options = {exact: true};</p>
<p>WL.JSONStore.get(collectionName).remove(query, options).then(function (numberOfDocsRemoved) {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="remove-collection">Remove Collection</h2>
<p>Use <code>removeCollection</code> to delete all the documents that are stored inside a collection. This operation is similar to dropping a table in database terms</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';<br />
WL.JSONStore.get(collectionName).removeCollection().then(function (removeCollectionReturnCode) {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="destroy">Destroy</h2>
<p>Use <code>destroy</code> to remove the following data:</p>
<ul>
<li>All documents</li>
<li>All collections</li>
<li>All Stores (See "<strong>Multiple User Support</strong>" later in this tutorial)</li>
<li>All JSONStore metadata and security artifacts See "<strong>Security</strong>" later in this tutorial</li>
</ul>
<p>[code language="javascript"]<br />
var collectionName = 'people';<br />
WL.JSONStore.destroy().then(function () {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="security">Security</h2>
<p>You can secure all the collections in a store by passing a password to the <code>init</code> function. If no password is passed, the documents of all the collections in the store are not encrypted.</p>
<p>Data encryption is only available on Android, iOS, Windows Phone 8, and Windows 8 environments.</p>
<p>Some security metadata are stored in the keychain (iOS), shared preferences (Android), isolated storage (Windows 8 Phone), or the credential locker (Windows 8).</p>
<p>The store is encrypted with a 256-bit Advanced Encryption Standard (AES) key. All keys are strengthened with Password-Based Key Derivation Function 2 (PBKDF2).</p>
<p>Use <code>closeAll</code> to lock access to all the collections until you call <code>init</code> again. If you think of <code>init</code> as a login function you can think of <code>closeAll</code> as the corresponding logout function.</p>
<p>Use <code>changePassword</code> to change the password.</p>
<p>[code language="javascript"]<br />
var collections = {<br />
  people: {<br />
    searchFields: {name: 'string'}<br />
  }<br />
};</p>
<p>var options = {password: '123'};</p>
<p>WL.JSONStore.init(collections, options).then(function () {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="multi-user">Multiple User Support</h2>
<p>You can create multiple stores that contain different collections in a single MobileFirst application. The <code>init</code> function can take an options object with a username. If no username is given, the default username is <strong>jsonstore</strong></p>
<p>[code language="javascript"]<br />
var collections = {<br />
  people: {<br />
    searchFields: {name: 'string'}<br />
  }<br />
};</p>
<p>var options = {username: 'yoel'};</p>
<p>WL.JSONStore.init(collections, options).then(function () {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="adapter">MobileFirst Adapter Integration</h2>
<p>This section assumes that you are familiar with MobileFirst adapters. MobileFirst Adapter Integration is optional and provides ways to send data from a collection to an adapter and get data from an adapter into a collection.</p>
<p>You can achieve these goals by using functions such as <code>WL.Client.invokeProcedure</code> or <code>jQuery.ajax</code> if you need more flexibility.</p>
<h3>Adapter Implementation</h3>
<p>Create a MobileFirst adapter and name it "<strong>People</strong>". Define it's procedures <code>addPerson</code>, <code>getPeople</code>, <code>pushPeople</code>, <code>removePerson</code>, and <code>replacePerson</code>.</p>
<p>[code language="javascript"]<br />
function getPeople() {<br />
	var data = { peopleList : [{name: 'chevy', age: 23}, {name: 'yoel', age: 23}] };</p>
<p>	WL.Logger.debug('Adapter: people, procedure: getPeople called.');<br />
	WL.Logger.debug('Sending data: ' + JSON.stringify(data));</p>
<p>	return data;<br />
}</p>
<p>function pushPeople(data) {<br />
	WL.Logger.debug('Adapter: people, procedure: pushPeople called.');<br />
	WL.Logger.debug('Got data from JSONStore to ADD: ' + data);</p>
<p>	return;<br />
}</p>
<p>function addPerson(data) {<br />
	WL.Logger.debug('Adapter: people, procedure: addPerson called.');<br />
	WL.Logger.debug('Got data from JSONStore to ADD: ' + data);</p>
<p>	return;<br />
}</p>
<p>function removePerson(data) {<br />
	WL.Logger.debug('Adapter: people, procedure: removePerson called.');<br />
	WL.Logger.debug('Got data from JSONStore to REMOVE: ' + data);</p>
<p>	return;<br />
}</p>
<p>function replacePerson(data) {<br />
	WL.Logger.debug('Adapter: people, procedure: replacePerson called.');<br />
	WL.Logger.debug('Got data from JSONStore to REPLACE: ' + data);</p>
<p>	return;<br />
}<br />
[/code]</p>
<h3>Initialize a collection linked to a MobileFirst adapter</h3>
<p>[code language="javascript"]<br />
var collections = {<br />
  people : {<br />
    searchFields : {name: 'string', age: 'integer'},<br />
    adapter : {<br />
      name: 'People',<br />
      add: 'addPerson',<br />
  		remove: 'removePerson',<br />
  		replace: 'replacePerson',<br />
  		load: {<br />
        procedure: 'getPeople',<br />
    		params: [],<br />
    		key: 'peopleList'<br />
  		}<br />
  	}<br />
  }<br />
}</p>
<p>var options = {};</p>
<p>WL.JSONStore.init(collections, options).then(function () {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h3>Load data from MobileFirst Adapter</h3>
<p>When <code>load</code> is called, JSONStore uses some metadata about the adapter (<strong>name</strong> and <strong>procedure</strong>), which you previously passed to <code>init</code>, to determine what data to get from the adapter and eventually store it.</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';</p>
<p>WL.JSONStore.get(collectionName).load().then(function (loadedDocuments) {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h3> Get Push Required (Dirty Documents)</h3>
<p>Calling <code>getPushRequired</code> returns and array of so called "dirty documents", which are documents that have local modifications that do not exist on the back-end system. These documents are sent to the MobileFirst adapter when <code>push</code> is called.</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';</p>
<p>WL.JSONStore.get(collectionName).getPushRequired().then(function (dirtyDocuments) {<br />
  // handle success<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<p>To prevent JSONStore from marking the documents as "dirty", pass the option <code>{markDirty:false}</code> to <code>add</code>, <code>replace</code>, and <code>remove</code></p>
<h3>Push</h3>
<p><code>push</code> sends the documents that changed to the correct MobileFirst adapter procedure (i.e., <code>addPerson</code> is called with a document that was added locally). This mechanism is based on the last operation that is associated with the document that changed and the adapter metadata that is passed to <code>init</code>.</p>
<p>[code language="javascript"]<br />
var collectionName = 'people';</p>
<p>WL.JSONStore.get(collectionName).push().then(function (response) {<br />
  // handle success<br />
  // response is an empty array if all documents reached the server<br />
  // response is an array of error responses if some documents failed to reach the server<br />
}).fail(function (error) {<br />
  // handle failure<br />
});<br />
[/code]</p>
<h2 id="enhance">Enhance</h2>
<p>Use <code>enhance</code> to extend the core API to fit your needs, by adding functions to a collection prototype.</p>
<p>This example shows how to use <code>enhance</code> to adde the function <code>getValue</code> that works on the <code>keyvalue</code> collection. It takes a <code>key</code> (string) as it's only parameter and returns a single result.</p>
<p>[code language="javascript"]<br />
var collectionName = 'keyvalue';</p>
<p>WL.JSONStore.get(collectionName).enhance('getValue', function (key) {<br />
  var deferred = $.Deferred();<br />
  var collection = this;<br />
  //Do an exact search for the key<br />
  collection.find({key: key}, {exact:true, limit: 1}).then(deferred.resolve, deferred.reject);</p>
<p>  return deferred.promise();</p>
<p>});</p>
<p>//Usage:<br />
var key = 'myKey';</p>
<p>WL.JSONStore.get(collectionName).getValue(key).then(function (result) {<br />
  // handle success<br />
  // result contains an array of documents with the results from the find<br />
}).fail(function () {<br />
  // handle failure<br />
});<br />
[/code]</p>
<p><img class="alignright size-medium wp-image-9249" src="{{ site.baseurl }}/assets/backup/jsonstore-hybridscreen-605x1024.png" alt="jsonstore-hybridscreen" width="220" height="339" /></p>
<h2 id="sample">Sample application</h2>
<p><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/JSONStoreAPIBasicsProject.zip">Click to download</a> the Studio project.</p>
<p>The Studio project contains an application that demonstrates the use of JSONStore in a hybrid environment.</p>
<h2 id="info">For more information</h2>
<p>For more information about JSONStore, see the product user documentation.</p>
