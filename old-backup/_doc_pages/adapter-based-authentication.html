---
layout: doc_page
title: Adapter-based authentication
date: 
type: doc_page
published: false
status: trash
categories: []
tags:
- 7-2
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _syntaxhighlighter_encoded: '1'
  _wpas_done_all: '1'
  oasis_is_in_workflow: '0'
  _wp_trash_meta_status: publish
  _wp_trash_meta_time: '1444818006'
author:
  login: iadar@il.ibm.com
  email: IADAR@il.ibm.com
  display_name: IdanAdar
  first_name: IDAN
  last_name: ADAR
---
<p class="breadcrumbs">
&lt; <a href="../">Authentication and security</a></p>
<div id="samplesAndPersonas">
<div>
        Relevant to:</p>
<ul id="relevantForPersona">
<li class="ios">Native iOS</li>
<li class="android">Native Android</li>
<li class="wp8">Native Windows Phone 8</li>
<li class="wp8">Native Windows 8 Universal</li>
<li class="hybrid">Hybrid</li>
</ul></div>
</div>
<h2>Overview</h2>
<p>Adapter-based authentication enables you to implement the entire authentication logic, including validation of the credentials, in a JavaScript adapter.</p>
<p>This tutorial implements an adapter-based authentication mechanism that relies on a user name and a password.</p>
<p>This tutorial covers the following topics:</p>
<ul>
<li><a href="#config">Configuring the authenticationConfig.xml file</a></li>
<li><a href="#serverside">Creating the server-side authentication components</a></li>
<li><a href="#protectJavaAdapt">Protecting a Java adapter</a></li>
<li><a href="#protectJsAdapt">Protecting a JavaScript adapter</a></li>
<li><a href="#creatingTheClientsideAuthenticationComponents">Creating client-side authentication components</a></li>
</ul>
<h2 id="config">Configuring the authenticationConfig.xml file</h2>
<h3>Realms</h3>
<p>Add two authentication realms to the <code>realm</code> section of the <code>authenticationConfig.xml</code> file.</p>
<p>[code lang="xml"]<br />
  &amp;lt;realm loginModule=&amp;quot;AuthLoginModule&amp;quot; name=&amp;quot;AuthRealm&amp;quot;&amp;gt;<br />
    &amp;lt;className&amp;gt;com.worklight.integration.auth.AdapterAuthenticator&amp;lt;/className&amp;gt;<br />
      &amp;lt;parameter name=&amp;quot;login-function&amp;quot; value=&amp;quot;AuthAdapter.onAuthRequired&amp;quot;/&amp;gt;<br />
      &amp;lt;parameter name=&amp;quot;logout-function&amp;quot; value=&amp;quot;AuthAdapter.onLogout&amp;quot;/&amp;gt;<br />
  &amp;lt;/realm&amp;gt;<br />
[/code]</p>
<p>These realms use the <code>AuthLoginModule</code> login module, which is defined in the <a href="#loginmodule">LoginModule</a> section.<br />
Using the <code>com.worklight.integration.auth.AdapterAuthenticator</code> class means that the server-side part of the authenticator is defined in the adapter.<br />
Whenever the MobileFirst authentication framework detects an attempt to access a protected resource, an adapter function that is defined in a <code>login-function</code> parameter is called automatically.<br />
When logout is detected (explicit or session timeout), a <code>logout-function</code> is called automatically.<br />
In both cases, the parameter value syntax is <code>adapterName.functionName</code>.</p>
<h3 id="loginmodule">LoginModule</h3>
<p>Add a login module to the <code>loginModules</code> section of the <code>authenticationConfig.xml</code> file and call it <code>AuthLoginModule</code>.</p>
<p>[code lang="xml"]<br />
&amp;lt;loginModule name=&amp;quot;AuthLoginModule&amp;quot;&amp;gt;<br />
    &amp;lt;className&amp;gt;com.worklight.core.auth.ext.NonValidatingLoginModule&amp;lt;/className&amp;gt;<br />
&amp;lt;/loginModule&amp;gt;<br />
[/code]</p>
<p>Using a <code>NonValidatingLoginModule</code> class name means that no additional validation is performed by the MobileFirst platform, and the developer takes responsibility for the validation of credentials within the adapter.<br />
Because all authentication-related actions are done in the adapter code, using <code>NonValidatingLoginModule</code> is mandatory for adapter-based authentication.</p>
<h3>Security tests</h3>
<p>Add security tests to the <code>securityTests</code> section of the <code>authenticationConfig.xml</code> file.<br />
You must use this security test to protect the adapter procedure, so use the <code>customSecurityTest</code> element.<br />
Remember the security test names. You must use them in subsequent steps.<br />
<strong>Note:</strong> If you use Java adapters, this step is not required.</p>
<p>[code lang="xml"]<br />
  &amp;lt;customSecurityTest name=&amp;quot;AuthSecurityTest&amp;quot;&amp;gt;<br />
      &amp;lt;test isInternalUserID=&amp;quot;true&amp;quot; realm=&amp;quot;AuthRealm&amp;quot;/&amp;gt;<br />
  &amp;lt;/customSecurityTest&amp;gt;<br />
[/code]</p>
<h2 id="serverside">Creating the server-side authentication components</h2>
<p>The following diagram illustrates the adapter-based authentication process:</p>
<p><a href="https://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2015/04/09_05_flow_diagram.jpg"><img src="{{ site.baseurl }}/assets/09_05_flow_diagram.jpg" alt="09_05_flow_diagram" width="720" height="521" class="aligncenter size-full wp-image-15621" /></a></p>
<h3>Adapter XML</h3>
<p>Create an adapter that takes care of the authentication process. Name it <code>AuthAdapter</code>.<br />
This adapter includes the following procedure:</p>
<p>[code lang="xml"]<br />
&amp;lt;procedure name=&amp;quot;submitAuthentication&amp;quot; securityTest=&amp;quot;wl_unprotected&amp;quot;/&amp;gt;<br />
[/code]</p>
<p>The <code>submitAuthentication</code> procedure takes care of the authentication process. Note that when the challenge handler invokes the <code>submitAuthentication</code> call, it is responsible for handling all the possible responses. In particular, if the <code>submitAuthentication</code> call returns a challenge, it is passed to the invocation callback, and is not processed by the security framework.<br />
<br />
Note: It is required for the "submit" procedure to be unprotected by using the <code>wl_unprotected</code> security test.<br />
The following diagram shows the flow to implement:</p>
<p><a href="https://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2015/04/09_05_flow_diagram2.jpg"><img src="{{ site.baseurl }}/assets/09_05_flow_diagram2.jpg" alt="09_05_flow_diagram2" width="720" height="440" class="aligncenter size-full wp-image-15616" /></a></p>
<h3>onAuthRequired</h3>
<p>Whenever the framework detects an unauthenticated attempt to access a protected resource, the <code>onAuthRequired</code> function is called, as defined in the <code>authenticationConfig.xml</code> file.</p>
<p>[code lang="javascript"]<br />
function onAuthRequired(headers, errorMessage){<br />
    errorMessage = errorMessage ? errorMessage : null;</p>
<p>    return {<br />
        authRequired: true,<br />
        errorMessage: errorMessage<br />
    };<br />
}<br />
[/code]</p>
<p>The returned object is a <em>custom</em> challenge object that is sent to the application.<br />
This function receives the request headers and an optional <code>errorMessage</code> parameter. The object that is returned by this function is sent to the client application.<br />
<strong>Note:</strong> In the sample, the <code>authRequired:true</code> property in the challenge handler detects that the server is requesting authentication.</p>
<h3>submitAuthentication</h3>
<p>The <code>submitAuthentication</code> function is called by a client application to validate the user name and password.</p>
<p>[code lang="javascript"]<br />
function submitAuthentication(username, password){<br />
    if (username===&amp;quot;user&amp;quot; &amp;amp;&amp;amp; password === &amp;quot;password&amp;quot;){</p>
<p>        var userIdentity = {<br />
                userId: username,<br />
                displayName: username,<br />
                attributes: {<br />
                    foo: &amp;quot;bar&amp;quot;<br />
                }<br />
        };</p>
<p>        WL.Server.setActiveUser(&amp;quot;AuthRealm&amp;quot;, userIdentity);</p>
<p>        return {<br />
            authRequired: false<br />
        };<br />
    }</p>
<p>    return onAuthRequired(null, &amp;quot;Invalid login credentials&amp;quot;);<br />
}<br />
[/code]</p>
<p>The user name and password are received from the application as parameters. In this sample, the credentials are validated against some hardcoded values, but any other validation mode is valid, for example by using SQL or web services.<br />
If the validation passed successfully, the <code>WL.Server.setActiveUser</code> method is called to create an authenticated session for the <code>AuthRealm</code>, with user data stored in a <code>userIdentity</code> object. You can add your own custom properties to the user identity attributes.<br />
An object (<code>{authRequired: false}</code>) is sent to the application, stating that the authentication screen is no longer required.<br />
If credentials validation fails, an object that is built by the <code>onAuthRequired</code> function is returned to the application with a suitable error message.</p>
<h3>onLogout</h3>
<p>The <code>onLogout</code> function is defined in the <code>authenticationConfig.xml</code> file to be called automatically after a logout, for example to perform a cleanup. This step is optional.</p>
<p>[code lang="javascript"]<br />
function onLogout(){<br />
    WL.Logger.debug(&amp;quot;Logged out&amp;quot;);<br />
}<br />
[/code]</p>
<h2 id="protectJsAdapt">Protecting a Javascript adapter</h2>
<p>Create a new adapter or add the following procedure to the XML code of your existing adapter:<br />
[code lang="xml"]<br />
&amp;lt;procedure name=&amp;quot;getSecretData&amp;quot; securityTest=&amp;quot;AuthSecurityTest&amp;quot;/&amp;gt;<br />
[/code]</p>
<p>For training purposes, the <code>getSecretData</code> function returns a hardcoded value. Keep in mind that <code>getSecretData</code> is protected by a security test, as defined in the adapter XML.</p>
<p>[code lang="javascript"]<br />
function getSecretData(){<br />
    return {<br />
        secretData: &amp;quot;Very very very very secret data&amp;quot;<br />
    };<br />
}<br />
[/code]</p>
<h2 id="protectJavaAdapt">Protecting a Java adapter</h2>
<p>The adapter responsible for authenticating the user needs to be a JavaScript-based adapter. However, you can still use adapter-based authentication to protect other resources such as Java adapters.</p>
<ol>
<li>Create a Java adapter. Add a <code>getSecretData</code> method and protect it with the realm you created previously. In this module, the <code>getSecretData</code> procedure returns some hardcoded value:
<p>[code lang="java" highlight="3"]<br />
	@GET<br />
	@Produces(&amp;quot;application/json&amp;quot;)<br />
	@OAuthSecurity(scope=&amp;quot;AuthRealm&amp;quot;)<br />
	public JSONObject getSecretData(){<br />
		JSONObject result = new JSONObject();<br />
		result.put(&amp;quot;secretData&amp;quot;, &amp;quot;123456&amp;quot;);</p>
<p>		return result;<br />
	}<br />
[/code]
</li>
<li>To set our new realm as the default user identity for the application, add this option in the application descriptor:<br />
[code lang="xml"]<br />
&amp;lt;userIdentityRealms&amp;gt;AuthRealm&amp;lt;/userIdentityRealms&amp;gt;<br />
[/code]
</li>
</ol>
<blockquote><p>To learn more about application descriptor properties, see the user documentation.</p></blockquote>
<blockquote><p>Learn more in the "Implementing adapter-based authenticators" user documentation topic.</p></blockquote>
<h2 id="creatingTheClientsideAuthenticationComponents" class="noPrint">Creating the client-side authentication components</h2>
