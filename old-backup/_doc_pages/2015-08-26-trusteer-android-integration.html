---
layout: doc_page
title: Trusteer Android Integration
date: 2015-08-26 08:16:37.000000000 +03:00
type: doc_page
published: true
status: publish
categories: []
tags:
- 7-2
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _syntaxhighlighter_encoded: '1'
  _wpas_done_all: '1'
author:
  login: iadar@il.ibm.com
  email: IADAR@il.ibm.com
  display_name: IdanAdar
  first_name: IDAN
  last_name: ADAR
---
<p class="breadcrumbs">
&lt; <a href="../">Product Integration</a></p>
<div id="samplesAndPersonas">
<div>
        Relevant to:</p>
<ul id="relevantForPersona">
<li class="android">Native Android</li>
</ul></div>
<ul>
<li class="download-sample">
<a href="https://github.ibm.com/MFPSamples/TrusteerAndroid" target="_blank">Download MobileFirst project</a>
</li>
</ul>
</div>
<h2>Overview</h2>
<p>Trusteer Mobile SDK collects multiple mobile device risk factors and provides them to the mobile app, enabling organizations to restrict mobile app functionality based on risk levels.</p>
<p>In your IBM MobileFirst Platform Foundation application, you may want to protect access to some specific resources or procedures based risk levels, such as detected malware or whether the device is jailbroken or rooted.</p>
<p>For example, you could prevent a malware-ridden device from logging into your banking app, and prevent rooted devices from using the “transfer funds” feature.</p>
<h2>Obtain Trusteer SDK</h2>
<p>To use Trusteer within a IBM MobileFirst Platform Foundation application, you first need to separately obtain the Trusteer SDK, license information, required libraries and manifest files.<br />
See Trusteer documentation or contact Trusteer support if you are missing any of those items.<br />
You may receive those items either as separate files, or as an MobileFirst Application Component (WLC).<br />
You still need to follow these steps if you use a WLC file.</p>
<h2>Install Trusteer SDK</h2>
<p>If you’ve received an Application Component from Trusteer, search the IBM MobileFirst documentation for “Adding application components to MobileFirst projects”. Then make sure the file “<strong>tas.license</strong>” contains your license information.</p>
<p>If you’ve received the Trusteer SDK, follow the Trusteer documentation to add the Trusteer SDK to your Android project. Make sure you have the “<strong>tas.license</strong>” file in your “<strong>assets</strong>” folder. Its format should be:</p>
<p>[code]<br />
vendorId=com.mycompany<br />
clientId=my.client.id<br />
clientKey=YMAQAABNFUWS2L<br />
[/code]</p>
<h2>Access Risk Items in JavaScript</h2>
<p>Optionally, you can access the client-side generated Trusteer data object using the following API:<br />
[code lang="javascript"]<br />
WL.Trusteer.getRiskAssessment(onSuccess, onFailure);<br />
[/code]<br />
Where <code>onSuccess</code> is a function that will receive a <code>JSON</code> object containing all the data processed by Trusteer. See Trusteer documentation to get information on each risk item.<br />
[code lang="javascript"]<br />
function onSuccess(result) {<br />
  //See in the logs what the full result looks like<br />
  WL.Logger.debug(JSON.stringify(result));<br />
  //Check for a specific flag<br />
  if (result[&quot;os.rooted&quot;][&quot;value&quot;] != 0) {<br />
    alert(&quot;This device is jailbroken!&quot;);<br />
  }<br />
}<br />
[/code]</p>
<h2>Access Risk Items in Java</h2>
<p>Optionally, you can access the client-side generated Trusteer data object using the following API:<br />
[code lang="java"]<br />
WLTrusteer trusteer = WLTrusteer.getInstance();<br />
JSONObject risks = trusteer.getRiskAssessment();<br />
[/code]</p>
<p>This returns an <code>JSONObject</code> of all the data processed by Truster. See Trusteer documentation to get information on each risk item.<br />
[code lang="java"]<br />
JSONObject rooted = (JSONObject) risks.get(&quot;os.rooted&quot;);<br />
if(rooted.getInt(&quot;value&quot;) &gt; 0){<br />
	//device is rooted<br />
}<br />
[/code]</p>
<h2>Authentication Config</h2>
<p>To prevent access to specific resources when a device is at risk, you can protect your adapter procedures or your applications with a custom security test containing a Trusteer realm. See MobileFirst documentation for general information on security tests and realms.</p>
<p>The Trusteer realm will check the data generated by the Trusteer SDK and allow/reject the request based on the parameters you set.</p>
<p>Here is an example of a Trusteer realm and login module you can add to your <strong>authenticationConfig.xml</strong>.</p>
<p>[code lang="xml"]<br />
&lt;realms&gt;<br />
  ...<br />
  &lt;realm name=&quot;wl_basicTrusteerFraudDetectionRealm&quot; loginModule=&quot;trusteerFraudDetectionLogin&quot;&gt;<br />
    &lt;className&gt;<br />
      com.worklight.core.auth.ext.TrusteerAuthenticator<br />
    &lt;/className&gt;<br />
    &lt;parameter name=&quot;rooted-device&quot; value=&quot;block&quot; /&gt;<br />
    &lt;parameter name=&quot;device-with-malware&quot; value=&quot;block&quot; /&gt;<br />
    &lt;parameter name=&quot;rooted-hiders&quot; value=&quot;block&quot; /&gt;<br />
    &lt;parameter name=&quot;unsecured-wifi&quot; value=&quot;alert&quot; /&gt;<br />
    &lt;parameter name=&quot;outdated-configuration&quot; value=&quot;alert&quot; /&gt;<br />
  &lt;/realm&gt;<br />
&lt;/realms&gt;<br />
[/code]</p>
<p>[code lang="xml"]<br />
&lt;loginModules&gt;<br />
  ...<br />
  &lt;loginModule name=&quot;trusteerFraudDetectionLogin&quot;&gt;<br />
    &lt;className&gt;<br />
      com.worklight.core.auth.ext.TrusteerLoginModule<br />
    &lt;/className&gt;<br />
  &lt;/loginModule&gt;<br />
&lt;/loginModules&gt;<br />
[/code]</p>
<p>This realm contains 5 parameters:</p>
<ul>
<li><strong>rooted-device</strong> - indicates whether the device is rooted (android) or jailbroken (iOS)</li>
<li><strong>device-with-malware</strong>  - indicates whether the device contains malware</li>
<li><strong>rooted-hiders</strong> - indicate that the device contains root hiders applications that hides the fact that the device is rooted/jailbroken</li>
<li><strong>unsecured-wifi</strong> - indicates that the device is currently connected to an insecure wifi.</li>
<li><strong>outdated-configuration</strong> - indicates that Trusteer SDK  configuration hasn't updated for some time (didn't connect to the Trusteer server).</li>
</ul>
<p>The possible values are <code>block</code>, <code>alert</code> or <code>accept</code>.</p>
<h2>JavaScript Challenge Handler</h2>
<p>Assuming you’ve added a Trusteer realm to your server’s authentication configuration file, you can register a challenge handler to receive the responses from the authenticator.<br />
[code lang="javascript"]<br />
var trusteerChallengeHandler = WL.Client.createWLChallengeHandler(&quot;wl_basicTrusteerFraudDetectionRealm&quot;);<br />
[/code]<br />
Notice that you are registering a <code>WLChallengeHandler</code> and not a <code>ChallengeHandler</code>. See IBM MobileFirst documentation on <code>WLChallengeHandler</code>.</p>
<p>If you have set one of your realm options to <code>block</code>, a blocking event will trigger <code>handleFailure</code>.<br />
[code lang="javascript"]<br />
trusteerChallengeHandler.handleFailure = function(error) {<br />
      WL.SimpleDialog.show(&quot;Error&quot;, &quot;Operation failed. Please contact customer support (reason code: &quot; + error.reason + &quot;)&quot;,  [{text:&quot;OK&quot;}]);<br />
};<br />
[/code]<br />
<strong><code>error.reason</code></strong> can be one of the following:</p>
<ul>
<li><code>TAS_ROOT</code></li>
<li><code>TAS_ROOT_EVIDENCE</code></li>
<li><code>TAS_MALWARE</code></li>
<li><code>TAS_WIFI</code></li>
<li><code>TAS_OUTDATED</code></li>
<li><code>TAS_INVALID_HEADER</code></li>
<li><code>TAS_NO_HEADER</code></li>
</ul>
<p>If your have set one of your realm options to alert, you can catch the alert event by implementing the <code>processSuccess</code> method.<br />
[code lang="javascript"]<br />
trusteerChallengeHandler.processSuccess = function(identity) {<br />
  var alerts = identity.attributes.alerts; //Array of alerts codes<br />
  if (alerts.length &gt; 0) {<br />
    WL.SimpleDialog.show(&quot;Warning&quot;, &quot;Please note that your device is: &quot; + alerts, [{<br />
      text: &quot;OK &quot;<br />
    }]);<br />
  }<br />
};<br />
[/code]</p>
<h2>Native Challenge Handler</h2>
<p>Assuming you’ve added a Trusteer realm to your server’s authentication configuration file, you can register a challenge handler to receive the responses from the authenticator.</p>
<p>Create a class that extends <code>WLChallengeHandler</code>:<br />
[code lang="java"]<br />
public class TrusteerChallengeHandler extends WLChallengeHandler{<br />
//...<br />
}<br />
[/code]</p>
<p>In your application code, register your newly created challenge handler for your Trusteer realm:<br />
[code lang="java"]<br />
WLClient.getInstance().registerChallenge(<br />
  new TrusteerChallengeHandler(&quot;wl_basicTrusteerFraudDetectionRealm&quot;);<br />
);<br />
[/code]</p>
<p>If you have set one of your realm options to block, a blocking event will trigger <code>handleFailure</code>.<br />
[code lang="java"]<br />
public class TrusteerChallengeHandler extends WLChallengeHandler {<br />
//...<br />
  public void handleFailure(JSONObject error){<br />
      String errorReason = error.getString(&quot;reason&quot;);<br />
      //Show user that the request was denied.<br />
  }<br />
//...<br />
}<br />
[/code]</p>
<p><strong><code>error.reason</code></strong> can be one of the following:</p>
<ul>
<li><code>TAS_ROOT</code></li>
<li><code>TAS_ROOT_EVIDENCE</code></li>
<li><code>TAS_MALWARE</code></li>
<li><code>TAS_WIFI</code></li>
<li><code>TAS_OUTDATED</code></li>
<li><code>TAS_INVALID_HEADER</code></li>
<li><code>TAS_NO_HEADER</code></li>
</ul>
<p>If your have set one of your realm options to alert, you can catch the alert event by implementing the <code>handleSuccess</code> method.</p>
<p>[code lang="java"]<br />
public class TrusteerChallengeHandler extends WLChallengeHandler{<br />
//…<br />
  public void handleSuccess(JSONObject identity){<br />
    JSONArray alerts = identity.getJSONObject(“attributes”).getJSONArray(“alerts”);</p>
<p>  	if(alerts.length() &gt; 0) {<br />
  		//Alert the user of potential issues.<br />
  	}<br />
  }<br />
//...<br />
}<br />
[/code]</p>
<h2>Sample application</h2>
<p><a href="https://github.ibm.com/MFPSamples/TrusteerAndroid" target="_blank">Click to download</a> the MobileFirst project.</p>
<h3>Sample Setup</h3>
<p>Download the TrusteerIntegrationProject.<br />
Import it into your MobileFirst Studio workspace.<br />
For pure native, download and import TrusteerAndroidNativeProject as well (update <strong>wlclient.properties</strong> with your IP address)<br />
Install the Trusteer SDK into your application(s) following the steps explained previously.<br />
Deploy and run it on your Android device.</p>
<p>The sample will display whether or not it successfully loaded the Trusteer SDK.<br />
It will display whether your device is rooted or not.<br />
It features a button to “<strong>get sensitive data</strong>”, which invokes a dummy procedure protected by a Trusteer realm.<br />
Depending on the state of your device, you should see “<strong>this is sensitive data</strong>”, or an error explaining why your request was rejected.</p>
