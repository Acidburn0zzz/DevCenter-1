---
layout: doc_page
title: Event source-based notifications in native Windows 8 applications
date: 2015-01-07 10:48:38.000000000 +02:00
type: doc_page
published: true
status: publish
categories: []
tags:
- 7-0
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
author:
  login: nathanh@il.ibm.com
  email: NATHANH@il.ibm.com
  display_name: Nathan Hazout
  first_name: NATHAN
  last_name: HAZOUT
---
<p class="breadcrumbs">
 &lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-7-0/notifications">Notifications</a> &lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-7-0/notifications/push-notification-native-windows-8-applications/">Push notifications in native Windows 8 applications</a></p>
<div id="samplesAndPersonas">
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="wp8">Native Windows 8</li>
</ul>
</div>
<ul>
<li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/PushNotificationsNativeProject.zip">Download Studio project</a>
    </li>
<li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/Windows8NativePushProject.zip">Download native project</a>
    </li>
</ul>
</div>
<h2>Overview</h2>
<p>Event source notifications are notification messages that are targeted to devices with a user subscription.</p>
<p>To learn more about the architecture and terminology of push notifications in IBM MobileFirst™ Platform Foundation, see the “<a href="/mobilefirstplatform/documentation/getting-started-7-0/notifications/push-notifications-hybrid-applications/event-source-based-notifications/">Event source-based notifications in hybrid applications</a>” tutorial.</p>
<p>For more information about setting up push notifications in native Windows 8 applications, see the “<a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-7-0/notifications/push-notification-native-windows-8-applications/">Push notifications in native Windows 8 applications</a>” tutorial.</p>
<p>Go to:</p>
<ul>
<li><a href="#serverSideApi">Notification API - Server-side</a></li>
<li><a href="#clientSideApi">Notification API - Client-side</a></li>
<li><a href="#sample">Sample application</a></li>
</ul>
<h2 id="serverSideApi">Notification API: Server-side</h2>
<h3>Creating an event source</h3>
<p>Create a notification event source in the adapter JavaScript™ code at a global level (outside any JavaScript function).<br />
[code lang="js"]<br />
WL.Server.createEventSource({<br />
    name: 'PushEventSource',<br />
    onDeviceSubscribe: 'deviceSubscribeFunc',<br />
    onDeviceUnsubscribe: 'deviceUnsubscribeFunc',<br />
    securityTest:'PushApplication-strong-mobile-securityTest'<br />
});<br />
[/code]</p>
<ul>
<li><code>name</code> – A name by which the event source is referenced.</li>
<li><code>onDeviceSubscribe</code> – An adapter function that is called when the request for user subscription is received.</li>
<li><code>onDeviceUnsubscribe</code> – An adapter function that is called when the request for user unsubscription is received.</li>
<li><code>securityTest</code> – A security test from the <code>authenticationConfig.xml</code> file, which is used to protect the event source.</li>
</ul>
<h3>Sending a notification</h3>
<p>Notifications can be either polled from, or pushed by, the back-end system. In this example, a <code>submitNotifications()</code> adapter function is invoked by a back-end system as an external API to send notifications.</p>
<p>[code lang="js"]function submitNotification(userId, notificationText) {<br />
    var userSubscription = WL.Server.getUserNotificationSubscription('PushAdapter.PushEventSource', userId);</p>
<p>    if (userSubscription === null) {<br />
        return { result: &quot;No subscription found for user :: &quot; + userId };<br />
    }</p>
<p>    var badgeDigit = 1;<br />
    var notification = WL.Server.createDefaultNotification(notificationText, badgeDigit, {custom:&quot;data&quot;});</p>
<p>        WL.Server.notifyAllDevices(userSubscription, notification);</p>
<p>    return {<br />
        result: &quot;Notification sent to user :: &quot; + userId<br />
    };<br />
}[/code]</p>
<h2 id="clientSideApi">Notification API - Client-side</h2>
<p>The first step is to create an instance of the <code>WLClient</code> class:</p>
<p>[code lang="csharp"]WLClient client = WLClient.getInstance();[/code]</p>
<p>You derive all push notification operations from the <code>WLPush</code> class.</p>
<ul>
<code>getPush</code>  –  Use this method to retrieve an instance of the <code>WLPush</code> class from the <code>WLClient</code> instance.</p>
<p>[code lang="csharp"]WLPush push = client.getPush();[/code]</p>
<p><code>WLOnReadyToSubscribeListener</code> – When connecting to MobileFirst Server, the application attempts to register itself with the Google Cloud Messaging (GCM) server to receive push notifications.</p>
<p>[code lang="csharp"]<br />
 OnReadyToSubscribeListener myOnReadyListener = new OnReadyToSubscribeListener();<br />
 push.onReadyToSubscribeListener = myOnReadyListener;<br />
[/code]</p>
<p>The <code>onReadyToSubscribe</code> method of <code>WLOnReadyToSubscribeListener</code> is called when the registration is complete.</p>
<p>[code lang="csharp"]<br />
public void onReadyToSubscribe()<br />
{...}<br />
[/code]
</ul>
<h3><code>WLPush.registerEventSourceCallback</code></h3>
<p>To register an alias on a particular event source, use the <code>WLPush.registerEventSourceCallback</code> method.</p>
<p>The API takes the following arguments:</p>
<ul>
<span class="inline-code">alias</span> - An alias name.<br />
<span class="inline-code">Adaptername</span> - Adapter in which the event source is defined.<br />
<span class="inline-code">EventSourceName</span> - The event source on which the alias is called.
</ul>
<p>Example:</p>
<p>[code lang="csharp"]<br />
WLClient.getInstance().getPush().registerEventSourceCallback(&quot;myPush&quot;, &quot;PushAdapter&quot;, &quot;PushEventSource&quot;, this);<br />
[/code]</p>
<p>Typically, this method is called in the <code>onReadyToSubscribe</code> callback function.</p>
<p>[code lang="csharp"]<br />
public void onReadyToSubscribe()<br />
{<br />
  WLClient.getInstance().getPush().registerEventSourceCallback(&quot;myPush&quot;, &quot;PushAdapter&quot;,&quot;PushEventSource&quot;, this);<br />
}[/code]</p>
<p><br clear="all" /></p>
<h3>Subscribing to push notification</h3>
<p>To set up subscription to push notification, use the <code>WLPush.subscribe(alias, pushOptions, responseListener)</code> API.</p>
<p>The API takes the following arguments:</p>
<ul>
<p><code>alias</code> – The alias to which the device must subscribe.<br />
<code>pushOptions</code> – An object of type <code>WLPushOptions</code>.<br />
<code>responseListener</code> – An object of type <code>WLResponseListener</code>, which is called when subscription completes.
</ul>
<p>Example:</p>
<p>[code lang="csharp"]<br />
WLPush push = WLClient.getInstance().getPush();<br />
MySubscribeListener mySubListener = new MySubscribeListener();<br />
push.subscribe(&quot;myPush&quot;, null, mySubListener);<br />
[/code]</p>
<p><code>MySubscribeListener</code> implements <code>WLResponseListener</code> and provides the following callback functions:</p>
<ul>
<p><code>onSuccess</code> – Called when subscription succeeds.<br />
<code>onFailure</code> – Called when subscription fails.</p>
</ul>
<h3>Unsubscribing from push notifications</h3>
<p>To set up unsubscription from push notification, use the <code>WLPush.unsubscribe(alias, responseListener)</code> API.</p>
<p>The API takes the following arguments:</p>
<ul>
<p><code>alias</code> – The alias to which the device has subscribed.<br />
<code>responseListener</code> – An object of type <code>WLResponseListener</code>, which is called when unsubscription completes.
</ul>
<p>Example:</p>
<p>[code lang="csharp"]<br />
WLPush push = WLClient.getInstance().getPush();<br />
MyUnsubscribeListener myUnsubListener = new MyUnsubscribeListener();<br />
push.unsubscribe(&quot;myPush&quot;, myUnsubListener);<br />
[/code]</p>
<p><code>MyUnsubscribeListener</code> implements <code>WLResponseListener</code> and provides the following callback functions:</p>
<ul>
<p><code>onSuccess</code> – Called when unsubscription succeeds.<br />
<code>onFailure</code> – Called when unsubscription fails.</p>
</ul>
<h3>Additional client-side API methods</h3>
<p><code>isSubscribed()</code> - Indicates whether the device is subscribed to push notifications.</p>
<p>[code lang="csharp"]<br />
WLClient.getInstance().getPush().isSubscribed(&quot;myPush&quot;);<br />
[/code]</p>
<h3>Receiving a push notification</h3>
<p>When a push notification is received, the <code>onReceive</code> method is called on an <code>WLEventSourceListener</code> instance.</p>
<p>[code lang="csharp"]<br />
class OnReadyToSubscribeListener : WLOnReadyToSubscribeListener, WLEventSourceListener{...}<br />
[/code]</p>
<p>The <code>WLEventSourceListener</code> instance is registered during the <code>registerEventSourceCallback</code> callback.</p>
<p>[code lang="csharp"]<br />
WLClient.getInstance().getPush().registerEventSourceCallback(&quot;myPush&quot;, &quot;PushAdapter&quot;, &quot;PushEventSource&quot;, this);<br />
[/code]</p>
<p>The <code>onReceive</code> method displays the received notification on the screen.</p>
<p>[code lang="csharp"]<br />
public void onReceive(String props, String payload)<br />
{<br />
     Debug.WriteLine(&quot;Props: &quot; + props);<br />
     Debug.WriteLine(&quot;Payload: &quot; + payload);</p>
<p>}<br />
[/code]</p>
<h2 id="sample">Sample application</h2>
<p><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/PushNotificationsNativeProject.zip">Click to download</a> the Studio project.<br />
<a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v700/Windows8NativePushProject.zip">Click to download</a> the Native project.</p>
<p>The sample contains two projects:</p>
<ul>
<li>The <code>PushNotificationsNativeProject.zip</code> file contains a <strong>MobileFirst native API</strong> that you can deploy to your MobileFirst Server instance.</li>
<li>The <code>Windows8NativePushProject.zip</code> file contains a <strong>native Windows 8 application</strong> that uses a MobileFirst native API library to subscribe to push notifications and receive notifications from Windows Notification Services (WNS).<br />
Make sure to update the <code>wlclient.properties</code> file in Windows8NativePushProject with the relevant server settings.</li>
</ul>
