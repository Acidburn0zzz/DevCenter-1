---
layout: doc_page
title: Advanced adapter usage and mashup
date: 2014-07-23 05:57:17.000000000 +03:00
type: doc_page
published: true
status: publish
categories: []
tags: []
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"984a002a47179f5ee40a1e2a09fbfe45";a:2:{s:7:"expires";i:1442502975;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:10957;}i:1;a:1:{s:2:"id";i:11038;}i:2;a:1:{s:2:"id";i:10945;}}}}
author:
  login: iadar@il.ibm.com
  email: IADAR@il.ibm.com
  display_name: IdanAdar
  first_name: IDAN
  last_name: ADAR
---
<p class="breadcrumbs">
 &lt; <a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-6-3/server-side-development/">Server-side development</a></p>
<div id="samplesAndPersonas">
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="hybrid"><a href="https://developer.ibm.com/mobilefirstplatform/documentation/getting-started-hybrid-development-6-3/">Hybrid</a></li>
</ul>
</div>
<ul>
<li class="download-sample">
      <a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/AdapterMashUpProject.zip">Download Studio project</a>
    </li>
</ul>
</div>
<h2>Overview</h2>
<p>Now that basic usage of different types of adapters has been covered in previous tutorials, it is important to remember that adapters can be combined to make a procedure that uses different adapters to generate one processed result. You can combine several sources (different HTTP servers, SQL, etc).</p>
<p>In theory, from the client-side, one could make several requests successively, one depending on the other.<br />
However, writing this logic on the server-side could be faster and cleaner.</p>
<h2>invokeProcedure</h2>
<p>At the heart of this mashup scenario is the <code>WL.Server.invokeProcedure(invocationData)</code> API. Almost identical to its client-side counterpart, it enables you to invoke a procedure on any of your adapters.</p>
<p>The <code>invocationData</code> parameter has the same format as the client-side API.<br />
[code lang="javascript"]<br />
WL.Server.invokeProcedure({ adapter : &quot;AcmeBank&quot;, procedure : &quot; getTransactions&quot;, parameters : [accountId, fromDate, toDate], });<br />
[/code]</p>
<p>However, while the client-side <code>invokeProcedure</code> uses a success handler, the server-side one returns the result object itself.</p>
<h2>Data Mashup Sample</h2>
<p>The following example shows how to mash up data from two data sources and to return the data stream to the application as a single <code>invocationResult</code> object.</p>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/04_12_flow.png"><img src="{{ site.baseurl }}/assets/04_12_flow.png" alt="04_12_flow" width="2034" height="1128" class="aligncenter size-full wp-image-3273" /></a></p>
<p>Data mashup can be implemented in the same way for any number of data sources and across different adapter types.<br />
As an example, mash up data from the following sources:</p>
<ul>
<li>
    SQL:</p>
<ul>
<li>Extract a list of cities from a "weather" database table.</li>
<li>The result contains the list of several cities around the world, their Yahoo! Weather identifier and some description.</li>
</ul>
</li>
<li>HTTP:
<ul>
<li>Connect to the Yahoo! Weather Service. </li>
<li>Extract an updated weather forecast for each of the cities that are retrieved via SQL.</li>
</ul>
</li>
</ul>
<p>Afterward, the mashed-up data is returned to the application for display.</p>
<h3>HTTP Adapter</h3>
<ol>
<li>Create an HTTP adapter and name it <strong>HTTPWeather</strong>. This adapter connects to Yahoo! Weather RSS feed at http://weather.yahooapis.com/forecastrss.
<p>The adapter has a single procedure called <code>getYahooWeather</code>.<br />
The HTTP request has the following parameters:</p>
<ul>
<li><strong><code>w</code></strong> – Where in the world ID, a city ID used by Yahoo!</li>
<li><strong><code>u</code></strong> – units. Can be "c" for Celsius or "f" for Fahrenheit.</li>
</ul>
</li>
<li>Create the <code>getYahooWeather</code> function in the <strong>HTTPWeather-impl.js</strong> file and use it to retrieve and return the weather data by using the Yahoo! Weather API:
<p>[code lang="javascript"]<br />
function getYahooWeather(woeid) {</p>
<p>	var input = {<br />
	    method : 'get',<br />
	    returnedContentType : 'xml',<br />
	    path : 'forecastrss',<br />
		parameters : {<br />
			'w' : woeid,<br />
			'u' : 'c' //celsius<br />
		}<br />
	};</p>
<p>	return WL.Server.invokeHttp(input);<br />
}<br />
[/code]
</li>
</ol>
<h3>SQL Adapter</h3>
<ol>
<li>Create a SQL adapter and name it <strong>SQLAdapter</strong>. This adapter contains:
<ul>
<li><strong><code>getCitiesWeather</code></strong> – a public procedure, which is declared in the adapter XML file. It is called from the application and returns the mashed-up data.</li>
<li><strong><code>getCitiesList</code></strong> – an internal (private) function, which is not declared in the adapter XML file. It is called from the adapter through server API to get the cities list from the SQL server.</li>
<li><strong><code>getCityWeather</code></strong> – an internal (private) function, which is not declared in the adapter XML file. It calls the <code>getYahooWeather</code> procedure from a different adapter (HTTP) with the Yahoo! Weather ID as a parameter.</li>
</ul>
<p>An example of city list in SQL is provided with the attached sample, under <strong>server/mobilefirstTraining.sql</strong>.<br />
Remember that SQL Adapters require a JDBC connector driver, which must be downloaded separately by the developer and added to the <strong>server/lib</strong> folder of the project.</p>
</li>
<li>Create a <code>getCitiesList</code> function in the <strong>SQLAdapter-impl.js</strong> file and use it to retrieve and return the city list from the SQL database.<br />
[code lang="javascript"]<br />
var getCitiesListStatement = WL.Server.createSQLStatement(&quot;select city, identifier, summary from weather;&quot;);<br />
function getCitiesList() {<br />
	return WL.Server.invokeSQLStatement({<br />
		preparedStatement : getCitiesListStatement,<br />
		parameters : []<br />
	});<br />
}<br />
[/code]</p>
</li>
<li>Create a <code>getCityWeather</code> function in the <strong>SQLAdapter-impl.js</strong> file and use it to retrieve and return the weather data from the HTTPWeather adapter:<br />
[code lang="javascript"]<br />
function getCityWeather(woeid){<br />
	return WL.Server.invokeProcedure({<br />
		adapter : 'HTTPWeather',<br />
		procedure : 'getYahooWeather',<br />
		parameters : [woeid]<br />
	});<br />
}<br />
[/code]</p>
</li>
<li>In the SQL adapter, extract a city identifier from the city list that was retrieved earlier and use it to call the <code>getYahooWeather</code> procedure of the HTTPWeather adapter.
</li>
<li>Repeat for each city, attaching the received data to the city object.
<p>[code lang="javascript"]<br />
function getCitiesWeather(){<br />
	var cityList = getCitiesList();<br />
	for (var i = 0; i &lt; cityList.resultSet.length; i++) {<br />
		var yahooWeatherData = getCityWeather(cityList.resultSet[i].identifier);</p>
<p>		if (yahooWeatherData.isSuccessful)<br />
			cityList.resultSet[i].weather = yahooWeatherData.rss.channel.item.description;<br />
	}<br />
	return cityList;<br />
}<br />
[/code]</p>
</li>
<li>Return the mashed-up data to the application, which you can process in client-side code.
</li>
</ol>
<h2>Sample application</h2>
<p><a href="http://public.dhe.ibm.com/software/products/en/MobileFirstPlatform/docs/v630/AdapterMashUpProject.zip">Click to download</a> the Studio project.</p>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/04_12_results.png"><img src="{{ site.baseurl }}/assets/04_12_results.png" alt="04_12_results" width="319" height="545" class="aligncenter size-full wp-image-3275" /></a></p>
