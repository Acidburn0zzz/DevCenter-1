---
layout: doc_page
title: Advanced adapter usage and mashup
date: 2015-04-16 08:18:03.000000000 +03:00
type: doc_page
published: true
status: publish
categories: []
tags:
- 7-1
meta:
  _wpcom_is_markdown: '1'
  _edit_last: '6643'
  _wpas_done_all: '1'
  _syntaxhighlighter_encoded: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"984a002a47179f5ee40a1e2a09fbfe45";a:2:{s:7:"expires";i:1442512812;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:6034;}i:1;a:1:{s:2:"id";i:10945;}i:2;a:1:{s:2:"id";i:11038;}}}}
author:
  login: nathanh@il.ibm.com
  email: NATHANH@il.ibm.com
  display_name: Nathan Hazout
  first_name: NATHAN
  last_name: HAZOUT
---
<p class="breadcrumbs">
 &lt; <a href="../">Server-side development</a></p>
<div id="samplesAndPersonas">
<div>
    Relevant to:</p>
<ul id="relevantForPersona">
<li class="hybrid">Hybrid</li>
</ul>
</div>
<ul>
<li class="download-sample">
<a href="https://github.com/MobileFirst-Platform-Developer-Center/AdapterMashup" target="_blank">Download MobileFirst project</a>
        </li>
</ul>
</div>
<p><br clear="all" /><br />
Now that basic usage of different types of adapters has been covered, it is important to remember that adapters can be combined to make a procedure that uses different adapters to generate one processed result. You can combine several sources (different HTTP servers, SQL, etc).</p>
<p>In theory, from the client side, you could make several requests successively, one depending on the other.<br />
However, writing this logic on the server side could be faster and cleaner.</p>
<p>This tutorial covers the following topics:</p>
<ul>
<li><a href="#invoke">invokeProcedure</a></li>
<li><a href="#dataMashup">Data mashup example</a></li>
<li><a href="#sample">Sample application</a></li>
</ul>
<h2 id="invoke">invokeProcedure</h2>
<p>At the heart of this mashup scenario is the <code>WL.Server.invokeProcedure(invocationData)</code> API. Almost identical to its client-side counterpart, it enables you to invoke a procedure on any of your adapters.</p>
<p>The <code>invocationData</code> parameter has the same format as the client-side API.<br />
[code lang="javascript"]<br />
WL.Server.invokeProcedure({ adapter : &quot;AcmeBank&quot;, procedure : &quot; getTransactions&quot;, parameters : [accountId, fromDate, toDate], });<br />
[/code]</p>
<p>However, while the client-side <code>invokeProcedure</code> uses a success handler, the server-side one returns the result object itself.</p>
<h2 id="dataMashup">Data mashup example</h2>
<p>The following example shows how to mash up data from two data sources and to return the data stream to the application as a single <code>invocationResult</code> object.</p>
<p><a href="https://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2015/04/04_12_flow.jpg"><img src="{{ site.baseurl }}/assets/04_12_flow.jpg" alt="04_12_flow" width="720" height="500" class="aligncenter size-full wp-image-12201" /></a></p>
<p>Data mashup can be implemented in the same way for any number of data sources and across different adapter types.<br />
As an example, mash up data from the following sources:</p>
<ul>
<li>
    SQL:</p>
<ul>
<li>Extract a list of cities from a “weather” database table.</li>
<li>The result contains the list of several cities around the world, their Yahoo! Weather identifier and some description.</li>
</ul>
</li>
<li>HTTP:
<ol>
<li>Connect to the Yahoo! Weather Service. </li>
<li>Extract an updated weather forecast for each of the cities that are retrieved via SQL.</li>
</ol>
</li>
</ul>
<p>Afterward, the mashed-up data is returned to the application for display.</p>
<h3>HTTP Adapter</h3>
<ol>
<li>Create an HTTP adapter and name it <strong>HTTPWeather</strong>. This adapter connects to Yahoo! Weather RSS feed at <code>http://weather.yahooapis.com/forecastrss</code>.
<p>The adapter has a single procedure called <code>getYahooWeather</code>.<br />
The HTTP request has the following parameters:</p>
<ul>
<li><strong><code>w</code></strong> – Where in the world ID, a city ID used by Yahoo!</li>
<li><strong><code>u</code></strong> – units. Can be "c" for Celsius or "f" for Fahrenheit.</li>
</ul>
</li>
<li>Create the <code>getYahooWeather</code> function in the <code>HTTPWeather-impl.js</code> file and use it to retrieve and return the weather data by using the Yahoo! Weather API:
<p>[code lang="javascript"]<br />
function getYahooWeather(woeid) {</p>
<p>  var input = {<br />
      method : 'get',<br />
      returnedContentType : 'xml',<br />
      path : 'forecastrss',<br />
    parameters : {<br />
      'w' : woeid,<br />
      'u' : 'c' //celsius<br />
    }<br />
  };</p>
<p>  return WL.Server.invokeHttp(input);<br />
}<br />
[/code]
</li>
</ol>
<h3>SQL Adapter</h3>
<ol>
<li>Create an SQL adapter and name it <strong>SQLAdapter</strong>. This adapter contains:
<ul>
<li><strong><code>getCitiesWeather</code></strong> – A public procedure, which is declared in the adapter XML file. It is called from the application and returns the mashed-up data.</li>
<li><strong><code>getCitiesList</code></strong> – An internal (private) function, which is not declared in the adapter XML file. It is called from the adapter through server API to get the cities list from the SQL server.</li>
<li><strong><code>getCityWeather</code></strong> – An internal (private) function, which is not declared in the adapter XML file. It calls the <code>getYahooWeather</code> procedure from a different adapter (HTTP) with the Yahoo! Weather ID as a parameter.</li>
</ul>
<p>An example of city list in SQL is provided with the attached sample, under <code>server/mobilefirstTraining.sql</code>.<br />
Remember that SQL adapters require a JDBC connector driver, which must be downloaded separately by the developer and added to the <code>server/lib</code> folder of the project.</p>
</li>
<li>Create a <code>getCitiesList</code> function in the <code>SQLAdapter-impl.js</code> file and use it to retrieve and return the city list from the SQL database.<br />
[code lang="javascript"]<br />
var getCitiesListStatement = WL.Server.createSQLStatement(&quot;select city, identifier, summary from weather;&quot;);<br />
function getCitiesList() {<br />
  return WL.Server.invokeSQLStatement({<br />
    preparedStatement : getCitiesListStatement,<br />
    parameters : []<br />
  });<br />
}<br />
[/code]</p>
</li>
<li>Create a <code>getCityWeather</code> function in the <code>SQLAdapter-impl.js</code> file and use it to retrieve and return the weather data from the HTTPWeather adapter:<br />
[code lang="javascript"]<br />
function getCityWeather(woeid){<br />
  return WL.Server.invokeProcedure({<br />
    adapter : 'HTTPWeather',<br />
    procedure : 'getYahooWeather',<br />
    parameters : [woeid]<br />
  });<br />
}<br />
[/code]</p>
</li>
<li>In the SQL adapter, extract a city identifier from the city list that was retrieved earlier and use it to call the <code>getYahooWeather</code> procedure of the HTTPWeather adapter.
</li>
<li>Repeat for each city, attaching the received data to the city object.
<p>[code lang="javascript"]<br />
function getCitiesWeather(){<br />
  var cityList = getCitiesList();<br />
  for (var i = 0; i &lt; cityList.resultSet.length; i++) {<br />
    var yahooWeatherData = getCityWeather(cityList.resultSet[i].identifier);</p>
<p>    if (yahooWeatherData.isSuccessful)<br />
      cityList.resultSet[i].weather = yahooWeatherData.rss.channel.item.description;<br />
  }<br />
  return cityList;<br />
}<br />
[/code]</p>
</li>
<li>Return the mashed-up data to the application, which you can process in client-side code.
</li>
</ol>
<h2 id="sample">Sample application</h2>
<p><a href="https://github.com/MobileFirst-Platform-Developer-Center/AdapterMashup" target="_blank">Click to download</a> the MobileFirst project.</p>
<p><a href="http://developer.ibm.com/mobilefirstplatform/wp-content/uploads/sites/32/2014/07/04_12_results.png"><img src="{{ site.baseurl }}/assets/04_12_results.png" alt="04_12_results" width="319" height="545" class="aligncenter size-full wp-image-3275" /></a></p>
